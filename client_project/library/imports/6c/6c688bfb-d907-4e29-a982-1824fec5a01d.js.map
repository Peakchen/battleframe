{"version":3,"sources":["assets\\scripts\\Player.js"],"names":["Global","require","wsNet","cc","Class","Component","properties","jumpHeight","jumpDuration","maxMoveSpeed","accel","jumpAudio","type","AudioClip","accDirection","getwsNetObj","setJumpAction","jumpUp","moveBy","v2","easing","easeCubicActionOut","jumpDown","easeCubicActionIn","callback","callFunc","playJumpSound","repeatForever","sequence","audioEngine","playEffect","onKeyDown","event","keyCode","macro","KEY","a","accLeft","d","accRight","onKeyUp","onLoad","game","setFrameRate","swConnect","FirstLogin","xSpeed","Math","random","systemEvent","on","SystemEvent","EventType","KEY_DOWN","KEY_UP","randPlayerPos","onDestroy","off","node","x","width","stop","sendPlayerPos","msgid","log","y","buff","ArrayBuffer","data","Uint32Array","nodexflag","nodex","parseInt","nodeyflag","nodey","sendwsmessage","update","dt","CanSendMsg","MID_login","abs","Bumped","MID_move"],"mappings":"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","sourceRoot":"/","sourcesContent":["let Global = require(\"common\")\nlet wsNet = require(\"wsNet\")\n\ncc.Class({\n    extends: cc.Component,\n    \n    properties: {\n        // 主角跳跃高度\n        jumpHeight: 0,\n        // 主角跳跃持续时间\n        jumpDuration: 0,\n        // 最大移动速度\n        maxMoveSpeed: 0,\n        // 加速度\n        accel: 0,\n        // 跳跃音效资源\n        jumpAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        //\n        accDirection: 0,\n    },\n\n    getwsNetObj: function() {\n        return new wsNet();\n    },\n\n    setJumpAction: function () {\n        // 跳跃上升\n        var jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight)).easing(cc.easeCubicActionOut());\n        // 下落\n        var jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight)).easing(cc.easeCubicActionIn());\n        // 添加一个回调函数，用于在动作结束时调用我们定义的其他方法\n        var callback = cc.callFunc(this.playJumpSound, this);\n        // 不断重复，而且每次完成落地动作后调用回调来播放声音\n        return cc.repeatForever(cc.sequence(jumpUp, jumpDown, callback));\n    },\n\n    playJumpSound: function () {\n        // 调用声音引擎播放声音\n        cc.audioEngine.playEffect(this.jumpAudio, false);\n    },\n\n    onKeyDown (event) {\n        // set a flag when key pressed\n        switch(event.keyCode) {\n            case cc.macro.KEY.a:\n                this.accLeft = true;\n                break;\n            case cc.macro.KEY.d:\n                this.accRight = true;\n                break;\n        }\n    },\n\n    onKeyUp (event) {\n        // unset a flag when key released\n        switch(event.keyCode) {\n            case cc.macro.KEY.a:\n                this.accLeft = false;\n                break;\n            case cc.macro.KEY.d:\n                this.accRight = false;\n                break;\n        }\n    },\n\n    onLoad: function() {\n        cc.game.setFrameRate(100);\n        this.getwsNetObj().swConnect()\n        Global.FirstLogin = null\n        // 初始化跳跃动作\n        //this.jumpAction = this.setJumpAction();\n        //this.node.runAction(this.jumpAction);\n        // 加速度方向开关\n        this.accLeft = false;\n        this.accRight = false;\n\n        // 主角当前水平方向速度\n        this.xSpeed = (Math.random() - 0.5) * 2 * 10;\n\n        // 初始化键盘输入监听\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);  \n        \n        //初始化小球位置\n        this.randPlayerPos()\n    },\n\n    onDestroy () {\n        // 取消键盘输入监听\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    },    \n\n    //初始化随机小球所在位置，然后广播给其他人\n    randPlayerPos: function() {\n        this.node.x = this.xSpeed * (this.node.width/2)\n        this.xSpeed = 0\n        //this.sendPlayerPos(Global.MID_login)\n        //cc.log(\"randPlayerPos player pos: \", this.node.x, this.node.y)\n    },\n\n    stop: function(){\n        this.xSpeed = 0\n    },\n\n    sendPlayerPos: function(msgid) {\n        cc.log(\"send player pos: \", msgid, this.node.x, this.node.y)\n\n        var buff = new ArrayBuffer(24)\n        var data = new Uint32Array(buff)\n\n        data[0] = msgid //消息ID\n        data[1] = 4 //消息长度\n\n        var nodexflag = 1\n        var nodex = this.node.x\n        if (nodex < 0.0) {\n            nodexflag = 2\n            nodex = 0.0 - nodex\n        }\n\n        data[2] = nodexflag     //x坐标正负\n        data[3] = parseInt(nodex) //x坐标\n        var nodeyflag = 1\n        var nodey = -88 //this.node.y\n        if (nodey < 0.0) {\n            nodeyflag = 2\n            nodey = 0.0 - nodey\n        }\n\n        data[4] = nodeyflag    //y坐标正负\n        data[5] = parseInt(nodey) //y坐标\n\n        this.getwsNetObj().sendwsmessage(data)\n    },\n\n    update: function (dt) {\n        //cc.log(\"player dt: \", this.accDirection, this.xSpeed)\n        //第一次连线广播所在位置，然后获取其他小球所在位置然后进行展示\n        if (Global.FirstLogin == null && this.getwsNetObj().CanSendMsg()){\n            this.sendPlayerPos(Global.MID_login)\n            //this.scheduleOnce(function(){ this.sendPlayerPos(Global.MID_login); },2);\n            Global.FirstLogin = 1\n        }\n\n        // 根据当前加速度方向每帧更新速度\n        if (this.accLeft) {\n            this.xSpeed -= this.accel * dt;\n        } else if (this.accRight) {\n            this.xSpeed += this.accel * dt;\n        }\n        // 限制主角的速度不能超过最大值\n        if ( Math.abs(this.xSpeed) > this.maxMoveSpeed ) {\n            // if speed reach limit, use max speed with current direction\n            this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);\n        }\n\n        // 根据当前速度更新主角的位置\n        /**\n         * 超过边界则自动滚回场景内\n         */\n        if (this.node.x <= -595.0) {\n            //this.xSpeed += this.accel * dt;\n            this.xSpeed = 0\n            this.node.x = -595.0 + 20\n        }else if (this.node.x >= 595.0) {\n            //this.xSpeed -= this.accel * dt;\n            this.node.x = 595.0 - 20\n            this.xSpeed = 0\n        }else{\n            this.node.x += this.xSpeed * dt;\n        }\n\n        if (Global.Bumped == 1){\n            this.xSpeed = 0\n            Global.Bumped = null\n            //移动广播所在位置，然后获取其他小球所在位置然后进行展示\n            this.sendPlayerPos(Global.MID_move)\n        }\n        //cc.log(\"player pos: \", this.node.x, this.node.y)\n    },\n});\n\n\n"]}