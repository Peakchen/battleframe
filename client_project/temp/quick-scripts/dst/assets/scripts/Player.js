
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Player.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6c688v72QdOKamCGCT+xaAd', 'Player');
// scripts/Player.js

"use strict";

var Global = require("common");

var wsNet = require("wsNet");

var GM = require("gm");

cc.Class({
  "extends": cc.Component,
  properties: {
    // 主角跳跃高度
    jumpHeight: 0,
    // 主角跳跃持续时间
    jumpDuration: 0,
    // 最大移动速度
    maxMoveSpeed: 0,
    // 加速度
    accel: 0,
    // 跳跃音效资源
    jumpAudio: {
      "default": null,
      type: cc.AudioClip
    },
    //
    accDirection: 0
  },
  getwsNetObj: function getwsNetObj() {
    return new wsNet();
  },
  getGMObj: function getGMObj() {
    return new GM();
  },
  setJumpAction: function setJumpAction() {
    // 跳跃上升
    var jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight)).easing(cc.easeCubicActionOut()); // 下落

    var jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight)).easing(cc.easeCubicActionIn()); // 添加一个回调函数，用于在动作结束时调用我们定义的其他方法

    var callback = cc.callFunc(this.playJumpSound, this); // 不断重复，而且每次完成落地动作后调用回调来播放声音

    return cc.repeatForever(cc.sequence(jumpUp, jumpDown, callback));
  },
  playJumpSound: function playJumpSound() {
    // 调用声音引擎播放声音
    cc.audioEngine.playEffect(this.jumpAudio, false);
  },
  onKeyDown: function onKeyDown(event) {
    // set a flag when key pressed
    switch (event.keyCode) {
      case cc.macro.KEY.a:
        this.accLeft = true;
        break;

      case cc.macro.KEY.d:
        this.accRight = true;
        break;
    }
  },
  onKeyUp: function onKeyUp(event) {
    // unset a flag when key released
    switch (event.keyCode) {
      case cc.macro.KEY.a:
        this.accLeft = false;
        break;

      case cc.macro.KEY.d:
        this.accRight = false;
        break;
    }
  },
  onLoad: function onLoad() {
    cc.game.setFrameRate(10);
    Global.FirstLogin = null;
    Global.newStarPos = new Map(); // 初始化跳跃动作
    //this.jumpAction = this.setJumpAction();
    //this.node.runAction(this.jumpAction);
    // 加速度方向开关

    this.accLeft = false;
    this.accRight = false; // 主角当前水平方向速度

    this.xSpeed = (Math.random() - 0.5) * 2 * 10;
    this.TickFrame = 0; // 初始化键盘输入监听

    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this); //初始化小球位置

    this.randPlayerPos(); //发送初始位置

    if (this.getwsNetObj().CanSendMsg()) this.sendPlayerPos(Global.MID_SyncPos);
  },
  onDestroy: function onDestroy() {
    // 取消键盘输入监听
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);
  },
  //初始化随机小球所在位置，然后广播给其他人
  randPlayerPos: function randPlayerPos() {
    this.node.x = this.xSpeed * (this.node.width / 2);
    this.xSpeed = 0; //cc.log("randPlayerPos player pos: ", this.node.x, this.node.y)
  },
  stop: function stop() {
    this.xSpeed = 0;
  },
  sendPlayerPos: function sendPlayerPos(msgid) {
    //cc.log("send player pos: ", msgid, this.TickFrame, this.node.x, this.node.y)
    if (Global.mySessionId == null) {
      return;
    }

    var buff = new ArrayBuffer(28);
    var data = new Uint32Array(buff);
    data[0] = msgid; //消息ID

    data[1] = 5; //消息长度

    var nodexflag = 1;
    var nodex = this.node.x;

    if (nodex < 0.0) {
      nodexflag = 2;
      nodex = 0.0 - nodex;
    }

    data[2] = nodexflag; //x坐标正负

    data[3] = parseInt(nodex); //x坐标

    var nodeyflag = 1;
    var nodey = -88; //this.node.y

    if (nodey < 0.0) {
      nodeyflag = 2;
      nodey = 0.0 - nodey;
    }

    data[4] = nodeyflag; //y坐标正负

    data[5] = parseInt(nodey); //y坐标

    data[6] = Global.mySessionId;
    this.getwsNetObj().sendwsmessage(data);
  },
  update: function update(dt) {
    //cc.log("player dt: ", this.accLeft, this.accRight)
    //方向移动操作后没任何方向操作时，则慢慢减速直至停止
    if (this.accLeft == false && this.accRight == false) {
      this.xSpeed -= 0.1;

      if (this.xSpeed < 0) {
        this.xSpeed = 0;
      }
    } // 根据当前加速度方向每帧更新速度


    if (this.accLeft) {
      this.xSpeed -= this.accel * dt;
    } else if (this.accRight) {
      this.xSpeed += this.accel * dt;
    } // 限制主角的速度不能超过最大值


    if (Math.abs(this.xSpeed) > this.maxMoveSpeed) {
      // if speed reach limit, use max speed with current direction
      this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);
    } // 根据当前速度更新主角的位置

    /**
     * 超过边界则自动滚回场景内
     */


    if (this.node.x <= -595.0) {
      //this.xSpeed += this.accel * dt;
      this.xSpeed = 0;
      this.node.x = -595.0 + 20;
    } else if (this.node.x >= 595.0) {
      //this.xSpeed -= this.accel * dt;
      this.node.x = 595.0 - 20;
      this.xSpeed = 0;
    } else {
      this.node.x += this.xSpeed * dt;
    }

    if (Global.Bumped == 1) {
      //this.xSpeed = 0
      Global.Bumped = null; //移动广播所在位置，然后获取其他小球所在位置然后进行展示

      this.sendPlayerPos(Global.MID_move);
    }

    this.TickFrame += dt;

    if (this.TickFrame > 10.0) {
      //更新帧数据
      this.sendPlayerPos(Global.MID_move);
      this.TickFrame = 0;
    } //cc.log("player pos: ", this.node.x, this.node.y)

  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcUGxheWVyLmpzIl0sIm5hbWVzIjpbIkdsb2JhbCIsInJlcXVpcmUiLCJ3c05ldCIsIkdNIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJqdW1wSGVpZ2h0IiwianVtcER1cmF0aW9uIiwibWF4TW92ZVNwZWVkIiwiYWNjZWwiLCJqdW1wQXVkaW8iLCJ0eXBlIiwiQXVkaW9DbGlwIiwiYWNjRGlyZWN0aW9uIiwiZ2V0d3NOZXRPYmoiLCJnZXRHTU9iaiIsInNldEp1bXBBY3Rpb24iLCJqdW1wVXAiLCJtb3ZlQnkiLCJ2MiIsImVhc2luZyIsImVhc2VDdWJpY0FjdGlvbk91dCIsImp1bXBEb3duIiwiZWFzZUN1YmljQWN0aW9uSW4iLCJjYWxsYmFjayIsImNhbGxGdW5jIiwicGxheUp1bXBTb3VuZCIsInJlcGVhdEZvcmV2ZXIiLCJzZXF1ZW5jZSIsImF1ZGlvRW5naW5lIiwicGxheUVmZmVjdCIsIm9uS2V5RG93biIsImV2ZW50Iiwia2V5Q29kZSIsIm1hY3JvIiwiS0VZIiwiYSIsImFjY0xlZnQiLCJkIiwiYWNjUmlnaHQiLCJvbktleVVwIiwib25Mb2FkIiwiZ2FtZSIsInNldEZyYW1lUmF0ZSIsIkZpcnN0TG9naW4iLCJuZXdTdGFyUG9zIiwiTWFwIiwieFNwZWVkIiwiTWF0aCIsInJhbmRvbSIsIlRpY2tGcmFtZSIsInN5c3RlbUV2ZW50Iiwib24iLCJTeXN0ZW1FdmVudCIsIkV2ZW50VHlwZSIsIktFWV9ET1dOIiwiS0VZX1VQIiwicmFuZFBsYXllclBvcyIsIkNhblNlbmRNc2ciLCJzZW5kUGxheWVyUG9zIiwiTUlEX1N5bmNQb3MiLCJvbkRlc3Ryb3kiLCJvZmYiLCJub2RlIiwieCIsIndpZHRoIiwic3RvcCIsIm1zZ2lkIiwibXlTZXNzaW9uSWQiLCJidWZmIiwiQXJyYXlCdWZmZXIiLCJkYXRhIiwiVWludDMyQXJyYXkiLCJub2RleGZsYWciLCJub2RleCIsInBhcnNlSW50Iiwibm9kZXlmbGFnIiwibm9kZXkiLCJzZW5kd3NtZXNzYWdlIiwidXBkYXRlIiwiZHQiLCJhYnMiLCJCdW1wZWQiLCJNSURfbW92ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxRQUFELENBQXBCOztBQUNBLElBQUlDLEtBQUssR0FBR0QsT0FBTyxDQUFDLE9BQUQsQ0FBbkI7O0FBQ0EsSUFBSUUsRUFBRSxHQUFHRixPQUFPLENBQUMsSUFBRCxDQUFoQjs7QUFFQUcsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTRCxFQUFFLENBQUNFLFNBRFA7QUFHTEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1I7QUFDQUMsSUFBQUEsVUFBVSxFQUFFLENBRko7QUFHUjtBQUNBQyxJQUFBQSxZQUFZLEVBQUUsQ0FKTjtBQUtSO0FBQ0FDLElBQUFBLFlBQVksRUFBRSxDQU5OO0FBT1I7QUFDQUMsSUFBQUEsS0FBSyxFQUFFLENBUkM7QUFTUjtBQUNBQyxJQUFBQSxTQUFTLEVBQUU7QUFDUCxpQkFBUyxJQURGO0FBRVBDLE1BQUFBLElBQUksRUFBRVQsRUFBRSxDQUFDVTtBQUZGLEtBVkg7QUFjUjtBQUNBQyxJQUFBQSxZQUFZLEVBQUU7QUFmTixHQUhQO0FBcUJMQyxFQUFBQSxXQUFXLEVBQUUsdUJBQVc7QUFDcEIsV0FBTyxJQUFJZCxLQUFKLEVBQVA7QUFDSCxHQXZCSTtBQXlCTGUsRUFBQUEsUUFBUSxFQUFFLG9CQUFXO0FBQ2pCLFdBQU8sSUFBSWQsRUFBSixFQUFQO0FBQ0gsR0EzQkk7QUE2QkxlLEVBQUFBLGFBQWEsRUFBRSx5QkFBWTtBQUN2QjtBQUNBLFFBQUlDLE1BQU0sR0FBR2YsRUFBRSxDQUFDZ0IsTUFBSCxDQUFVLEtBQUtYLFlBQWYsRUFBNkJMLEVBQUUsQ0FBQ2lCLEVBQUgsQ0FBTSxDQUFOLEVBQVMsS0FBS2IsVUFBZCxDQUE3QixFQUF3RGMsTUFBeEQsQ0FBK0RsQixFQUFFLENBQUNtQixrQkFBSCxFQUEvRCxDQUFiLENBRnVCLENBR3ZC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QUFsQjs7QUFDQSxRQUFJLEtBQUs5QixTQUFMLEdBQWlCLElBQXJCLEVBQTJCO0FBQ3ZCO0FBQ0EsV0FBS1MsYUFBTCxDQUFtQjdELE1BQU0sQ0FBQ3FGLFFBQTFCO0FBQ0EsV0FBS2pDLFNBQUwsR0FBaUIsQ0FBakI7QUFDSCxLQWxEaUIsQ0FtRGxCOztBQUNIO0FBek1JLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImxldCBHbG9iYWwgPSByZXF1aXJlKFwiY29tbW9uXCIpXG5sZXQgd3NOZXQgPSByZXF1aXJlKFwid3NOZXRcIilcbmxldCBHTSA9IHJlcXVpcmUoXCJnbVwiKVxuXG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuICAgIFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgLy8g5Li76KeS6Lez6LeD6auY5bqmXG4gICAgICAgIGp1bXBIZWlnaHQ6IDAsXG4gICAgICAgIC8vIOS4u+inkui3s+i3g+aMgee7reaXtumXtFxuICAgICAgICBqdW1wRHVyYXRpb246IDAsXG4gICAgICAgIC8vIOacgOWkp+enu+WKqOmAn+W6plxuICAgICAgICBtYXhNb3ZlU3BlZWQ6IDAsXG4gICAgICAgIC8vIOWKoOmAn+W6plxuICAgICAgICBhY2NlbDogMCxcbiAgICAgICAgLy8g6Lez6LeD6Z+z5pWI6LWE5rqQXG4gICAgICAgIGp1bXBBdWRpbzoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLkF1ZGlvQ2xpcFxuICAgICAgICB9LFxuICAgICAgICAvL1xuICAgICAgICBhY2NEaXJlY3Rpb246IDAsXG4gICAgfSxcblxuICAgIGdldHdzTmV0T2JqOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB3c05ldCgpO1xuICAgIH0sXG5cbiAgICBnZXRHTU9iajogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBuZXcgR00oKTtcbiAgICB9LFxuXG4gICAgc2V0SnVtcEFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyDot7Pot4PkuIrljYdcbiAgICAgICAgdmFyIGp1bXBVcCA9IGNjLm1vdmVCeSh0aGlzLmp1bXBEdXJhdGlvbiwgY2MudjIoMCwgdGhpcy5qdW1wSGVpZ2h0KSkuZWFzaW5nKGNjLmVhc2VDdWJpY0FjdGlvbk91dCgpKTtcbiAgICAgICAgLy8g5LiL6JC9XG4gICAgICAgIHZhciBqdW1wRG93biA9IGNjLm1vdmVCeSh0aGlzLmp1bXBEdXJhdGlvbiwgY2MudjIoMCwgLXRoaXMuanVtcEhlaWdodCkpLmVhc2luZyhjYy5lYXNlQ3ViaWNBY3Rpb25JbigpKTtcbiAgICAgICAgLy8g5re75Yqg5LiA5Liq5Zue6LCD5Ye95pWw77yM55So5LqO5Zyo5Yqo5L2c57uT5p2f5pe26LCD55So5oiR5Lus5a6a5LmJ55qE5YW25LuW5pa55rOVXG4gICAgICAgIHZhciBjYWxsYmFjayA9IGNjLmNhbGxGdW5jKHRoaXMucGxheUp1bXBTb3VuZCwgdGhpcyk7XG4gICAgICAgIC8vIOS4jeaWremHjeWkje+8jOiAjOS4lOavj+asoeWujOaIkOiQveWcsOWKqOS9nOWQjuiwg+eUqOWbnuiwg+adpeaSreaUvuWjsOmfs1xuICAgICAgICByZXR1cm4gY2MucmVwZWF0Rm9yZXZlcihjYy5zZXF1ZW5jZShqdW1wVXAsIGp1bXBEb3duLCBjYWxsYmFjaykpO1xuICAgIH0sXG5cbiAgICBwbGF5SnVtcFNvdW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIOiwg+eUqOWjsOmfs+W8leaTjuaSreaUvuWjsOmfs1xuICAgICAgICBjYy5hdWRpb0VuZ2luZS5wbGF5RWZmZWN0KHRoaXMuanVtcEF1ZGlvLCBmYWxzZSk7XG4gICAgfSxcblxuICAgIG9uS2V5RG93biAoZXZlbnQpIHtcbiAgICAgICAgLy8gc2V0IGEgZmxhZyB3aGVuIGtleSBwcmVzc2VkXG4gICAgICAgIHN3aXRjaChldmVudC5rZXlDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5hOlxuICAgICAgICAgICAgICAgIHRoaXMuYWNjTGVmdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5kOlxuICAgICAgICAgICAgICAgIHRoaXMuYWNjUmlnaHQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uS2V5VXAgKGV2ZW50KSB7XG4gICAgICAgIC8vIHVuc2V0IGEgZmxhZyB3aGVuIGtleSByZWxlYXNlZFxuICAgICAgICBzd2l0Y2goZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkuYTpcbiAgICAgICAgICAgICAgICB0aGlzLmFjY0xlZnQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLmQ6XG4gICAgICAgICAgICAgICAgdGhpcy5hY2NSaWdodCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uTG9hZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGNjLmdhbWUuc2V0RnJhbWVSYXRlKDEwKTtcbiAgICAgICAgXG4gICAgICAgIEdsb2JhbC5GaXJzdExvZ2luID0gbnVsbFxuICAgICAgICBHbG9iYWwubmV3U3RhclBvcyA9IG5ldyBNYXAoKTtcblxuICAgICAgICAvLyDliJ3lp4vljJbot7Pot4PliqjkvZxcbiAgICAgICAgLy90aGlzLmp1bXBBY3Rpb24gPSB0aGlzLnNldEp1bXBBY3Rpb24oKTtcbiAgICAgICAgLy90aGlzLm5vZGUucnVuQWN0aW9uKHRoaXMuanVtcEFjdGlvbik7XG4gICAgICAgIC8vIOWKoOmAn+W6puaWueWQkeW8gOWFs1xuICAgICAgICB0aGlzLmFjY0xlZnQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hY2NSaWdodCA9IGZhbHNlO1xuXG4gICAgICAgIC8vIOS4u+inkuW9k+WJjeawtOW5s+aWueWQkemAn+W6plxuICAgICAgICB0aGlzLnhTcGVlZCA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIgKiAxMDtcbiAgICAgICAgdGhpcy5UaWNrRnJhbWUgPSAwO1xuICAgICAgICAvLyDliJ3lp4vljJbplK7nm5jovpPlhaXnm5HlkKxcbiAgICAgICAgY2Muc3lzdGVtRXZlbnQub24oY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9ET1dOLCB0aGlzLm9uS2V5RG93biwgdGhpcyk7XG4gICAgICAgIGNjLnN5c3RlbUV2ZW50Lm9uKGNjLlN5c3RlbUV2ZW50LkV2ZW50VHlwZS5LRVlfVVAsIHRoaXMub25LZXlVcCwgdGhpcyk7ICBcbiAgICAgICAgXG4gICAgICAgIC8v5Yid5aeL5YyW5bCP55CD5L2N572uXG4gICAgICAgIHRoaXMucmFuZFBsYXllclBvcygpXG4gICAgICAgIC8v5Y+R6YCB5Yid5aeL5L2N572uXG4gICAgICAgIGlmICh0aGlzLmdldHdzTmV0T2JqKCkuQ2FuU2VuZE1zZygpKVxuICAgICAgICAgICAgdGhpcy5zZW5kUGxheWVyUG9zKEdsb2JhbC5NSURfU3luY1BvcylcbiAgICB9LFxuXG4gICAgb25EZXN0cm95ICgpIHtcbiAgICAgICAgLy8g5Y+W5raI6ZSu55uY6L6T5YWl55uR5ZCsXG4gICAgICAgIGNjLnN5c3RlbUV2ZW50Lm9mZihjYy5TeXN0ZW1FdmVudC5FdmVudFR5cGUuS0VZX0RPV04sIHRoaXMub25LZXlEb3duLCB0aGlzKTtcbiAgICAgICAgY2Muc3lzdGVtRXZlbnQub2ZmKGNjLlN5c3RlbUV2ZW50LkV2ZW50VHlwZS5LRVlfVVAsIHRoaXMub25LZXlVcCwgdGhpcyk7XG4gICAgfSwgICAgXG5cbiAgICAvL+WIneWni+WMlumaj+acuuWwj+eQg+aJgOWcqOS9jee9ru+8jOeEtuWQjuW5v+aSree7meWFtuS7luS6ulxuICAgIHJhbmRQbGF5ZXJQb3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLm5vZGUueCA9IHRoaXMueFNwZWVkICogKHRoaXMubm9kZS53aWR0aC8yKVxuICAgICAgICB0aGlzLnhTcGVlZCA9IDBcbiAgICAgICAgLy9jYy5sb2coXCJyYW5kUGxheWVyUG9zIHBsYXllciBwb3M6IFwiLCB0aGlzLm5vZGUueCwgdGhpcy5ub2RlLnkpXG4gICAgfSxcblxuICAgIHN0b3A6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMueFNwZWVkID0gMFxuICAgIH0sXG5cbiAgICBzZW5kUGxheWVyUG9zOiBmdW5jdGlvbihtc2dpZCkge1xuICAgICAgICAvL2NjLmxvZyhcInNlbmQgcGxheWVyIHBvczogXCIsIG1zZ2lkLCB0aGlzLlRpY2tGcmFtZSwgdGhpcy5ub2RlLngsIHRoaXMubm9kZS55KVxuXG4gICAgICAgIGlmIChHbG9iYWwubXlTZXNzaW9uSWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICB2YXIgYnVmZiA9IG5ldyBBcnJheUJ1ZmZlcigyOClcbiAgICAgICAgdmFyIGRhdGEgPSBuZXcgVWludDMyQXJyYXkoYnVmZilcblxuICAgICAgICBkYXRhWzBdID0gbXNnaWQgLy/mtojmga9JRFxuICAgICAgICBkYXRhWzFdID0gNSAvL+a2iOaBr+mVv+W6plxuXG4gICAgICAgIHZhciBub2RleGZsYWcgPSAxXG4gICAgICAgIHZhciBub2RleCA9IHRoaXMubm9kZS54XG4gICAgICAgIGlmIChub2RleCA8IDAuMCkge1xuICAgICAgICAgICAgbm9kZXhmbGFnID0gMlxuICAgICAgICAgICAgbm9kZXggPSAwLjAgLSBub2RleFxuICAgICAgICB9XG5cbiAgICAgICAgZGF0YVsyXSA9IG5vZGV4ZmxhZyAgICAgLy945Z2Q5qCH5q2j6LSfXG4gICAgICAgIGRhdGFbM10gPSBwYXJzZUludChub2RleCkgLy945Z2Q5qCHXG4gICAgICAgIHZhciBub2RleWZsYWcgPSAxXG4gICAgICAgIHZhciBub2RleSA9IC04OCAvL3RoaXMubm9kZS55XG4gICAgICAgIGlmIChub2RleSA8IDAuMCkge1xuICAgICAgICAgICAgbm9kZXlmbGFnID0gMlxuICAgICAgICAgICAgbm9kZXkgPSAwLjAgLSBub2RleVxuICAgICAgICB9XG5cbiAgICAgICAgZGF0YVs0XSA9IG5vZGV5ZmxhZyAgICAvL3nlnZDmoIfmraPotJ9cbiAgICAgICAgZGF0YVs1XSA9IHBhcnNlSW50KG5vZGV5KSAvL3nlnZDmoIdcbiAgICAgICAgZGF0YVs2XSA9IEdsb2JhbC5teVNlc3Npb25JZFxuXG4gICAgICAgIHRoaXMuZ2V0d3NOZXRPYmooKS5zZW5kd3NtZXNzYWdlKGRhdGEpXG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24gKGR0KSB7XG4gICAgICAgIC8vY2MubG9nKFwicGxheWVyIGR0OiBcIiwgdGhpcy5hY2NMZWZ0LCB0aGlzLmFjY1JpZ2h0KVxuICAgICAgICAvL+aWueWQkeenu+WKqOaTjeS9nOWQjuayoeS7u+S9leaWueWQkeaTjeS9nOaXtu+8jOWImeaFouaFouWHj+mAn+ebtOiHs+WBnOatolxuICAgICAgICBpZiAodGhpcy5hY2NMZWZ0ID09IGZhbHNlICYmIHRoaXMuYWNjUmlnaHQgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHRoaXMueFNwZWVkIC09IDAuMVxuICAgICAgICAgICAgaWYgKHRoaXMueFNwZWVkIDwgMCApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnhTcGVlZCA9IDBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOagueaNruW9k+WJjeWKoOmAn+W6puaWueWQkeavj+W4p+abtOaWsOmAn+W6plxuICAgICAgICBpZiAodGhpcy5hY2NMZWZ0KSB7XG4gICAgICAgICAgICB0aGlzLnhTcGVlZCAtPSB0aGlzLmFjY2VsICogZHQ7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5hY2NSaWdodCkge1xuICAgICAgICAgICAgdGhpcy54U3BlZWQgKz0gdGhpcy5hY2NlbCAqIGR0O1xuICAgICAgICB9XG4gICAgICAgIC8vIOmZkOWItuS4u+inkueahOmAn+W6puS4jeiDvei2hei/h+acgOWkp+WAvFxuICAgICAgICBpZiAoIE1hdGguYWJzKHRoaXMueFNwZWVkKSA+IHRoaXMubWF4TW92ZVNwZWVkICkge1xuICAgICAgICAgICAgLy8gaWYgc3BlZWQgcmVhY2ggbGltaXQsIHVzZSBtYXggc3BlZWQgd2l0aCBjdXJyZW50IGRpcmVjdGlvblxuICAgICAgICAgICAgdGhpcy54U3BlZWQgPSB0aGlzLm1heE1vdmVTcGVlZCAqIHRoaXMueFNwZWVkIC8gTWF0aC5hYnModGhpcy54U3BlZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g5qC55o2u5b2T5YmN6YCf5bqm5pu05paw5Li76KeS55qE5L2N572uXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDotoXov4fovrnnlYzliJnoh6rliqjmu5rlm57lnLrmma/lhoVcbiAgICAgICAgICovXG4gICAgICAgIGlmICh0aGlzLm5vZGUueCA8PSAtNTk1LjApIHtcbiAgICAgICAgICAgIC8vdGhpcy54U3BlZWQgKz0gdGhpcy5hY2NlbCAqIGR0O1xuICAgICAgICAgICAgdGhpcy54U3BlZWQgPSAwXG4gICAgICAgICAgICB0aGlzLm5vZGUueCA9IC01OTUuMCArIDIwXG4gICAgICAgIH1lbHNlIGlmICh0aGlzLm5vZGUueCA+PSA1OTUuMCkge1xuICAgICAgICAgICAgLy90aGlzLnhTcGVlZCAtPSB0aGlzLmFjY2VsICogZHQ7XG4gICAgICAgICAgICB0aGlzLm5vZGUueCA9IDU5NS4wIC0gMjBcbiAgICAgICAgICAgIHRoaXMueFNwZWVkID0gMFxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHRoaXMubm9kZS54ICs9IHRoaXMueFNwZWVkICogZHQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoR2xvYmFsLkJ1bXBlZCA9PSAxKXtcbiAgICAgICAgICAgIC8vdGhpcy54U3BlZWQgPSAwXG4gICAgICAgICAgICBHbG9iYWwuQnVtcGVkID0gbnVsbFxuICAgICAgICAgICAgLy/np7vliqjlub/mkq3miYDlnKjkvY3nva7vvIznhLblkI7ojrflj5blhbbku5blsI/nkIPmiYDlnKjkvY3nva7nhLblkI7ov5vooYzlsZXnpLpcbiAgICAgICAgICAgIHRoaXMuc2VuZFBsYXllclBvcyhHbG9iYWwuTUlEX21vdmUpXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLlRpY2tGcmFtZSArPSBkdFxuICAgICAgICBpZiAodGhpcy5UaWNrRnJhbWUgPiAxMC4wICl7XG4gICAgICAgICAgICAvL+abtOaWsOW4p+aVsOaNrlxuICAgICAgICAgICAgdGhpcy5zZW5kUGxheWVyUG9zKEdsb2JhbC5NSURfbW92ZSlcbiAgICAgICAgICAgIHRoaXMuVGlja0ZyYW1lID0gMFxuICAgICAgICB9XG4gICAgICAgIC8vY2MubG9nKFwicGxheWVyIHBvczogXCIsIHRoaXMubm9kZS54LCB0aGlzLm5vZGUueSlcbiAgICB9LFxufSk7XG5cblxuIl19