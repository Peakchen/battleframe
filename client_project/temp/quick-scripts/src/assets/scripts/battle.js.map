{"version":3,"sources":["assets\\scripts\\battle.js"],"names":["Api","require","Global","cc","Class","Component","getApi","getHost","getRandNumber","number","randseed","Rand","getRandOne","RandOne","postUpdateStarPosMsg","maxX","log","request","loader","getXMLHttpRequest","url","open","setRequestHeader","responseType","onreadystatechange","readyState","status","response","data","Uint32Array","starPosRandseed","starPosRandN","send","Uint16Array","postBattleStartMsg","parseInt","responseText","postAttackMsg","frame","dist","randn"],"mappings":";;;;;;AAAA,IAAIA,GAAG,GAAGC,OAAO,CAAC,KAAD,CAAjB;;AACA,IAAIC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAApB;;AAEAE,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAGL;AACAC,EAAAA,MAAM,EAAE,kBAAU;AACd,WAAO,IAAIN,GAAJ,EAAP;AACH,GANI;AAQL;AACAO,EAAAA,OAAO,EAAE,mBAAW;AAChB,WAAO,iBAAP;AACH,GAXI;AAaL;AACAC,EAAAA,aAAa,EAAE,uBAASC,MAAT,EAAgB;AAC3B,QAAIP,MAAM,CAACQ,QAAP,IAAmB,CAAvB,EAA0B;AACtB,aAAOD,MAAP;AACH;;AACD,WAAO,KAAKH,MAAL,GAAcK,IAAd,CAAmBF,MAAnB,EAA2BP,MAAM,CAACQ,QAAlC,CAAP;AACH,GAnBI;AAqBLE,EAAAA,UAAU,EAAE,oBAASF,QAAT,EAAkB;AAC1B,QAAIA,QAAQ,IAAI,CAAhB,EAAmB;AACfA,MAAAA,QAAQ,GAAGR,MAAM,CAACQ,QAAlB;AACH;;AACD,WAAO,KAAKJ,MAAL,GAAcO,OAAd,CAAsBH,QAAtB,CAAP;AACH,GA1BI;AA4BL;AACAI,EAAAA,oBAAoB,EAAE,8BAASC,IAAT,EAAc;AAChCZ,IAAAA,EAAE,CAACa,GAAH,CAAO,kCAAP;AACA,QAAIC,OAAO,GAAGd,EAAE,CAACe,MAAH,CAAUC,iBAAV,EAAd;AACA,QAAIC,GAAG,GAAG,KAAKb,OAAL,KAAiB,gBAA3B;AACAU,IAAAA,OAAO,CAACI,IAAR,CAAa,MAAb,EAAqBD,GAArB,EAA0B,IAA1B;AACAH,IAAAA,OAAO,CAACK,gBAAR,CAAyB,cAAzB,EAAyC,0BAAzC;AACAL,IAAAA,OAAO,CAACM,YAAR,GAAuB,aAAvB;;AACAN,IAAAA,OAAO,CAACO,kBAAR,GAA6B,YAAU;AACnC,UAAIP,OAAO,CAACQ,UAAR,IAAsB,CAAtB,IAA4BR,OAAO,CAACS,MAAR,IAAkB,GAAlB,IAAyBT,OAAO,CAACS,MAAR,GAAiB,GAA1E,EAAgF;AAC5EvB,QAAAA,EAAE,CAACa,GAAH,CAAO,0BAAP,EAAmCC,OAAO,CAACU,QAA3C;AACA,YAAIC,IAAI,GAAG,IAAIC,WAAJ,CAAgBZ,OAAO,CAACU,QAAxB,CAAX;AACAxB,QAAAA,EAAE,CAACa,GAAH,CAAO,sBAAP,EAA+BY,IAA/B;AACA1B,QAAAA,MAAM,CAAC4B,eAAP,GAAyBF,IAAI,CAAC,CAAD,CAA7B;AACA1B,QAAAA,MAAM,CAAC6B,YAAP,GAAsBH,IAAI,CAAC,CAAD,CAA1B;AACA;AACH;AACJ,KATD;;AAWAX,IAAAA,OAAO,CAACe,IAAR,CAAa,IAAIC,WAAJ,CAAgB,CAAC,CAAD,EAAIlB,IAAJ,CAAhB,CAAb;AACH,GAhDI;AAkDL;AACAmB,EAAAA,kBAAkB,EAAE,8BAAW;AAC3B,QAAIhC,MAAM,CAACQ,QAAP,GAAkB,CAAtB,EAAyB;AACrB;AACH;;AAEDP,IAAAA,EAAE,CAACa,GAAH,CAAO,kCAAP;AACA,QAAIC,OAAO,GAAGd,EAAE,CAACe,MAAH,CAAUC,iBAAV,EAAd;AACA,QAAIC,GAAG,GAAG,KAAKb,OAAL,KAAiB,cAA3B;AACAU,IAAAA,OAAO,CAACI,IAAR,CAAa,MAAb,EAAqBD,GAArB,EAA0B,IAA1B;AACAH,IAAAA,OAAO,CAACK,gBAAR,CAAyB,cAAzB,EAAyC,0BAAzC;;AACAL,IAAAA,OAAO,CAACO,kBAAR,GAA6B,YAAU;AACnC,UAAIP,OAAO,CAACQ,UAAR,IAAsB,CAAtB,IAA4BR,OAAO,CAACS,MAAR,IAAkB,GAAlB,IAAyBT,OAAO,CAACS,MAAR,GAAiB,GAA1E,EAAgF;AAC5ExB,QAAAA,MAAM,CAACQ,QAAP,GAAkByB,QAAQ,CAAClB,OAAO,CAACmB,YAAT,CAA1B;AACAjC,QAAAA,EAAE,CAACa,GAAH,CAAO,wBAAP,EAAiCC,OAAO,CAACmB,YAAzC;AACH;AACJ,KALD;;AAOAnB,IAAAA,OAAO,CAACe,IAAR,CAAa,IAAIC,WAAJ,CAAgB,CAAC,CAAD,CAAhB,CAAb,EAjB2B,CAiBQ;AACtC,GArEI;AAuEL;AACAI,EAAAA,aAAa,EAAE,uBAASC,KAAT,EAAgBC,IAAhB,EAAsB;AACjCpC,IAAAA,EAAE,CAACa,GAAH,CAAO,4BAAP,EAAqCd,MAAM,CAACQ,QAA5C;AACA,QAAIO,OAAO,GAAGd,EAAE,CAACe,MAAH,CAAUC,iBAAV,EAAd;AACA,QAAIC,GAAG,GAAG,KAAKb,OAAL,KAAiB,SAA3B;AACAU,IAAAA,OAAO,CAACI,IAAR,CAAa,MAAb,EAAqBD,GAArB,EAA0B,IAA1B;AACAH,IAAAA,OAAO,CAACK,gBAAR,CAAyB,cAAzB,EAAyC,0BAAzC;;AACAL,IAAAA,OAAO,CAACO,kBAAR,GAA6B,YAAU;AACnC,UAAIP,OAAO,CAACQ,UAAR,IAAsB,CAAtB,IAA4BR,OAAO,CAACS,MAAR,IAAkB,GAAlB,IAAyBT,OAAO,CAACS,MAAR,GAAiB,GAA1E,EAAgF;AAC5EvB,QAAAA,EAAE,CAACa,GAAH,CAAO,mBAAP,EAA4BC,OAAO,CAACmB,YAApC;AACH;AACJ,KAJD;;AAMA,QAAII,KAAK,GAAG,KAAKhC,aAAL,CAAmB+B,IAAnB,CAAZ;AACAtB,IAAAA,OAAO,CAACe,IAAR,CAAa,IAAIC,WAAJ,CAAgB,CAAC,CAAD,EAAIK,KAAJ,EAAWC,IAAX,EAAiBC,KAAjB,CAAhB,CAAb,EAbiC,CAasB;AAC1D;AAtFI,CAAT","sourceRoot":"/","sourcesContent":["let Api = require(\"api\")\r\nlet Global = require(\"common\")\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    //\r\n    getApi: function(){\r\n        return new Api()\r\n    },\r\n\r\n    //获取地址端口\r\n    getHost: function() {\r\n        return \"127.0.0.1:13001\";\r\n    },\r\n\r\n    //获取随机数\r\n    getRandNumber: function(number){\r\n        if (Global.randseed == 0) {\r\n            return number\r\n        }\r\n        return this.getApi().Rand(number, Global.randseed);\r\n    },\r\n\r\n    getRandOne: function(randseed){\r\n        if (randseed == 0) {\r\n            randseed = Global.randseed\r\n        }\r\n        return this.getApi().RandOne(randseed);\r\n    },\r\n\r\n    //发送更新star位置更新信息\r\n    postUpdateStarPosMsg: function(maxX){\r\n        cc.log(\"begin send battle start message.\")\r\n        var request = cc.loader.getXMLHttpRequest();\r\n        var url = this.getHost() + \"/UpdateStarPos\"\r\n        request.open(\"POST\", url, true)\r\n        request.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8\");\r\n        request.responseType = \"arraybuffer\";\r\n        request.onreadystatechange = function(){\r\n            if (request.readyState == 4 && (request.status >= 200 && request.status < 300)) {\r\n                cc.log(\"UpdateStarPos response: \", request.response)\r\n                var data = new Uint32Array(request.response)\r\n                cc.log(\"UpdateStarPos data: \", data)\r\n                Global.starPosRandseed = data[0]\r\n                Global.starPosRandN = data[1]\r\n                return \r\n            }\r\n        } \r\n\r\n        request.send(new Uint16Array([1, maxX]))\r\n    },\r\n\r\n    //发送战斗开始请求\r\n    postBattleStartMsg: function() {\r\n        if (Global.randseed > 0) {\r\n            return\r\n        }\r\n\r\n        cc.log(\"begin send battle start message.\")\r\n        var request = cc.loader.getXMLHttpRequest();\r\n        var url = this.getHost() + \"/BattleStart\"\r\n        request.open(\"POST\", url, true)\r\n        request.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8\");\r\n        request.onreadystatechange = function(){\r\n            if (request.readyState == 4 && (request.status >= 200 && request.status < 300)) {\r\n                Global.randseed = parseInt(request.responseText)\r\n                cc.log(\"BattleStart response: \", request.responseText)\r\n            }\r\n        } \r\n\r\n        request.send(new Uint16Array([1])) //param 1: 数据长度，param ...: 具体数据\r\n    },\r\n\r\n    //发送攻击请求\r\n    postAttackMsg: function(frame, dist) {\r\n        cc.log(\"begin send Attack message.\", Global.randseed)\r\n        var request = cc.loader.getXMLHttpRequest();\r\n        var url = this.getHost() + \"/Attack\"\r\n        request.open(\"POST\", url, true)\r\n        request.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8\");\r\n        request.onreadystatechange = function(){\r\n            if (request.readyState == 4 && (request.status >= 200 && request.status < 300)) {\r\n                cc.log(\"Attack response: \", request.responseText)\r\n            }\r\n        } \r\n\r\n        var randn = this.getRandNumber(dist)\r\n        request.send(new Uint16Array([3, frame, dist, randn])) //param 1: 数据长度，param ...: 具体数据\r\n    }\r\n})\r\n\r\n"]}