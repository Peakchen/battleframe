
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/wsNet.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'f5f02ULtVhD47PNH08lZ5uR', 'wsNet');
// scripts/wsNet.js

"use strict";

/**
 * websocket 
 */
var Global = require("common"); //心跳检测


var HeartCheck = {
  timeout: 60000,
  //60秒
  timeoutObj: null,
  serverTimeoutObj: null,
  disconnectioned: false,
  reconnectTimeoutobj: null,
  reset: function reset() {
    clearTimeout(this.timeoutObj);
    clearTimeout(this.serverTimeoutObj);
    return this;
  },
  startHeartBeat: function startHeartBeat() {
    var self = this;
    this.timeoutObj = setTimeout(function () {
      //这里发送一个心跳，后端收到后，返回一个心跳消息，onmessage拿到返回的心跳就说明连接正常
      cc.log("send heart beat...");

      if (Global.ws == null) {
        return;
      }

      var buff = new ArrayBuffer(12);
      var data = new Uint32Array(buff);
      data[0] = Global.MID_HeartBeat; //消息ID

      data[1] = 1; //消息长度

      data[2] = 0; //anything 随意填充一个数

      Global.ws.send(data);
      self.serverTimeoutObj = setTimeout(function () {
        //心跳超时主动断开
        cc.log("close connection...");

        if (Global.ws == null) {
          return;
        }

        Global.ws.close();
        self.disconnectioned = true;
      }, self.timeout);
    }, this.timeout);
  },
  hasDisconnected: function hasDisconnected() {
    return this.disconnectioned;
  },
  stopReconnectTimer: function stopReconnectTimer() {
    //cc.log("close reconnectTimeout...")
    clearTimeout(this.reconnectTimeoutobj);
  }
};
/**
 * 消息回复处理
 */

var MessageStateFunc = {
  /**
   * 消息解析 
   * 0: 消息id
   * 1：消息长度
   * 2：sessionid
   * 3：nodex x坐标正负标记
   * 4：nodex x坐标值
   * 5：nodey y坐标正负标记
   * 6：nodey y坐标值 
   */
  onlogin: function onlogin(data) {
    if (data[2] == 1) {
      Global.mySessionId = data[3];
    } else {
      return;
    }

    cc.log("ws message MID_login: ", data[2], data[3], data[4], data[5], data[6], data[7]);
    Global.LoginSucc = data[2];
    var nodex = data[5];
    var nodey = data[7];

    if (data[4] == 2) {
      nodex = 0 - nodex;
    }

    if (data[6] == 2) {
      nodey = 0 - nodey;
    }

    Global.MosterPosX = nodex;
    Global.MosterPosY = nodey;
  },
  onlogout: function onlogout(data) {
    var key = data[2].toString();
    cc.log("ws message MID_logout, sessionid: ", key);
    Global.DelPlayerIds.push(key);
    Global.PlayerSessionMap["delete"](key);
  },
  onmove: function onmove(data) {
    cc.log("ws message MID_move: ", data[1], data[2], data[3], data[4], data[5], data[6]);
    var key = data[6].toString();
    var nodex = data[3];
    var nodey = data[5];

    if (data[2] == 2) {
      nodex = 0 - nodex;
    }

    if (data[4] == 2) {
      nodey = 0 - nodey;
    }

    var playerProp = {
      sessionId: data[6],
      nodex: nodex,
      nodey: nodey
    };

    if (Global.PlayerSessionMap.has(key) == false) {
      Global.PlayerSessionMap.set(key, playerProp);
    }

    Global.NewplayerMap.set(key, playerProp);
    Global.newPlayerIds.push(key); //cc.log("MID_move purple monsters: ", Global.newPlayerIds.length, key, Global.NewplayerMap.has(key))
  },
  onBump: function onBump(data) {
    /**
     *  0: 消息ID
        1：消息长度
        2: 成功失败标志 (失败则只需要前三个字段)
        3: 星星x坐标正负标志
        4: 星星x坐标
        5：星星y坐标正负标志
        6：星星y坐标
        */
    if (data[2] == 0) {
      //失败
      cc.log("ws message MID_Bump fail ... ");
      return;
    }

    cc.log("ws message MID_Bump: ", data[1], data[2], data[3], data[4], data[5], data[6], data[7]);
    var nodex = data[4];
    var nodey = data[6];

    if (data[3] == 2) {
      nodex = 0 - nodex;
    }

    if (data[5] == 2) {
      nodey = 0 - nodey;
    }

    Global.BumpedPlayerId = data[7];
    var starProp = {
      nodex: nodex,
      nodey: nodey
    };
    Global.newStarPos.set(Global.newStarKey, starProp);
  },
  onHeartBeat: function onHeartBeat(data) {
    cc.log("ws message MID_HeartBeat: ", msgid);
  },
  onStarBorn: function onStarBorn(data) {
    cc.log("ws message MID_StarBorn: ", data[2], data[3], data[4], data[5]);
    /**
     *  0: 消息ID
        1：消息长度
        2: 星星x坐标正负标志
        3: 星星x坐标
        4：星星y坐标正负标志
        5：星星y坐标
     */

    var nodex = data[3];
    var nodey = data[5];

    if (data[2] == 2) {
      nodex = 0 - nodex;
    }

    if (data[4] == 2) {
      nodey = 0 - nodey;
    }

    var starProp = {
      nodex: nodex,
      nodey: nodey
    };
    Global.newStarPos.set(Global.newStarKey, starProp);
  },
  onGM: function onGM(data) {
    cc.log("ws message MID_GM...");
  },
  Online4Other: function Online4Other(data) {
    cc.log("ws message MID_Online4Other: ", data[1], data[2], data[3], data[4], data[5], data[6]);
    var key = data[2].toString();
    var nodex = data[4];
    var nodey = data[6];

    if (data[3] == 2) {
      nodex = 0 - nodex;
    }

    if (data[5] == 2) {
      nodey = 0 - nodey;
    }

    var playerProp = {
      sessionId: data[2],
      nodex: nodex,
      nodey: nodey
    };

    if (Global.PlayerSessionMap.has(key) == false) {
      Global.PlayerSessionMap.set(key, playerProp);
    }

    Global.NewplayerMap.set(key, playerProp);
    Global.newPlayerIds.push(key);
  },
  onRegister: function onRegister(data) {
    cc.log("ws message MID_Register: ", data[2]);
    Global.RegisterSucc = data[2];
  },
  onSyncPos: function onSyncPos(data) {
    cc.log("ws message MID_SyncPos: ", data[1], data[2], data[3], data[4], data[5], data[6]);
    var key = data[6].toString();
    var nodex = data[3];
    var nodey = data[5];

    if (data[2] == 2) {
      nodex = 0 - nodex;
    }

    if (data[4] == 2) {
      nodey = 0 - nodey;
    }

    var playerProp = {
      sessionId: data[6],
      nodex: nodex,
      nodey: nodey
    };

    if (Global.PlayerSessionMap.has(key) == false) {
      Global.PlayerSessionMap.set(key, playerProp);
    }

    Global.NewplayerMap.set(key, playerProp);
    Global.newPlayerIds.push(key);
  },
  onMonsterInfo: function onMonsterInfo(data) {
    cc.log("ws message MID_MonsterInfo: ", data[2], data[3]);
    Global.MonsterScore = data[3];
  }
};
cc.Class({
  //extends: cc.Component,

  /*
  readyState:
      CONNECTING 0
      OPEN       1
      CLOSING    2
      CLOSED     3
  */
  CanSendMsg: function CanSendMsg() {
    if (Global.ws == null) {
      return false;
    }

    return Global.ws.readyState == WebSocket.CONNECTING || Global.ws.readyState == WebSocket.OPEN;
  },
  swConnect: function swConnect() {
    if (Global.ws != null) {
      //return
      //cc.log("readyState: ", Global.ws.readyState)
      if (Global.ws.readyState == WebSocket.CONNECTING || Global.ws.readyState == WebSocket.OPEN) {
        //已经连上就不必再连
        return;
      }
    }

    var self = this;
    cc.log("addr: ", Global.wsAddr, Global.ws == null);
    var ws = new WebSocket(Global.wsAddr);

    ws.onopen = function (e) {
      cc.log("ws open: ", ws.readyState); //发送心跳

      HeartCheck.reset().startHeartBeat();
    };

    ws.onmessage = function (e) {
      var data = new Uint32Array(e.data);
      var msgid = data[0];

      switch (msgid) {
        case Global.MID_login:
          MessageStateFunc.onlogin(data);
          break;

        case Global.MID_logout:
          MessageStateFunc.onlogout(data);
          break;

        case Global.MID_move:
          MessageStateFunc.onmove(data);
          break;

        case Global.MID_Bump:
          MessageStateFunc.onBump(data);
          break;

        case Global.MID_HeartBeat:
          MessageStateFunc.onHeartBeat(data);
          break;

        case Global.MID_StarBorn:
          MessageStateFunc.onStarBorn(data);
          break;

        case Global.MID_GM:
          MessageStateFunc.onGM(data);
          break;

        case Global.MID_Online4Other:
          MessageStateFunc.Online4Other(data);
          break;

        case Global.MID_Register:
          MessageStateFunc.onRegister(data);
          break;

        case Global.MID_SyncPos:
          MessageStateFunc.onSyncPos(data);
          break;

        case Global.MID_MonsterInfo:
          MessageStateFunc.onMonsterInfo(data);
          break;

        default:
          cc.log("未知 消息id: ", msgid);
      } //发送心跳


      HeartCheck.reset().startHeartBeat();
    };

    ws.onerror = function (e) {
      cc.log("ws error: ", ws.readyState); //Global.ws = null

      if (HeartCheck.hasDisconnected() == false) {
        HeartCheck.stopReconnectTimer();
        HeartCheck.reconnectTimeoutobj = setTimeout(function () {
          self.swConnect();
        }, 1000);
      } else {
        HeartCheck.stopReconnectTimer();
      }
    };

    ws.onclose = function (e) {
      cc.log("ws close: ", ws.readyState); //Global.ws = null

      if (HeartCheck.hasDisconnected() == false) {
        HeartCheck.stopReconnectTimer();
        HeartCheck.reconnectTimeoutobj = setTimeout(function () {
          self.swConnect();
        }, 1000);
      } else {
        HeartCheck.stopReconnectTimer();
      }
    };

    cc.log("global ws init, state: ", ws.readyState);
    Global.ws = ws;
  },

  /**
   * 
   * @param {*} data  具体数据, 1：长度，2：是否广播，3：... 具体消息数据
   */
  sendwsmessage: function sendwsmessage(data) {
    if (Global.ws == null) {
      return;
    }

    if (Global.ws != null) {
      if (Global.ws.readyState == WebSocket.CLOSED || Global.ws.readyState == WebSocket.CLOSING) {
        //正在断开或者已经断开，则不能发送消息
        return;
      }
    } //cc.log("ws sendwsmessage: ", Global.ws.readyState)


    Global.ws.send(data);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcd3NOZXQuanMiXSwibmFtZXMiOlsiR2xvYmFsIiwicmVxdWlyZSIsIkhlYXJ0Q2hlY2siLCJ0aW1lb3V0IiwidGltZW91dE9iaiIsInNlcnZlclRpbWVvdXRPYmoiLCJkaXNjb25uZWN0aW9uZWQiLCJyZWNvbm5lY3RUaW1lb3V0b2JqIiwicmVzZXQiLCJjbGVhclRpbWVvdXQiLCJzdGFydEhlYXJ0QmVhdCIsInNlbGYiLCJzZXRUaW1lb3V0IiwiY2MiLCJsb2ciLCJ3cyIsImJ1ZmYiLCJBcnJheUJ1ZmZlciIsImRhdGEiLCJVaW50MzJBcnJheSIsIk1JRF9IZWFydEJlYXQiLCJzZW5kIiwiY2xvc2UiLCJoYXNEaXNjb25uZWN0ZWQiLCJzdG9wUmVjb25uZWN0VGltZXIiLCJNZXNzYWdlU3RhdGVGdW5jIiwib25sb2dpbiIsIm15U2Vzc2lvbklkIiwiTG9naW5TdWNjIiwibm9kZXgiLCJub2RleSIsIk1vc3RlclBvc1giLCJNb3N0ZXJQb3NZIiwib25sb2dvdXQiLCJrZXkiLCJ0b1N0cmluZyIsIkRlbFBsYXllcklkcyIsInB1c2giLCJQbGF5ZXJTZXNzaW9uTWFwIiwib25tb3ZlIiwicGxheWVyUHJvcCIsInNlc3Npb25JZCIsImhhcyIsInNldCIsIk5ld3BsYXllck1hcCIsIm5ld1BsYXllcklkcyIsIm9uQnVtcCIsIkJ1bXBlZFBsYXllcklkIiwic3RhclByb3AiLCJuZXdTdGFyUG9zIiwibmV3U3RhcktleSIsIm9uSGVhcnRCZWF0IiwibXNnaWQiLCJvblN0YXJCb3JuIiwib25HTSIsIk9ubGluZTRPdGhlciIsIm9uUmVnaXN0ZXIiLCJSZWdpc3RlclN1Y2MiLCJvblN5bmNQb3MiLCJvbk1vbnN0ZXJJbmZvIiwiTW9uc3RlclNjb3JlIiwiQ2xhc3MiLCJDYW5TZW5kTXNnIiwicmVhZHlTdGF0ZSIsIldlYlNvY2tldCIsIkNPTk5FQ1RJTkciLCJPUEVOIiwic3dDb25uZWN0Iiwid3NBZGRyIiwib25vcGVuIiwiZSIsIm9ubWVzc2FnZSIsIk1JRF9sb2dpbiIsIk1JRF9sb2dvdXQiLCJNSURfbW92ZSIsIk1JRF9CdW1wIiwiTUlEX1N0YXJCb3JuIiwiTUlEX0dNIiwiTUlEX09ubGluZTRPdGhlciIsIk1JRF9SZWdpc3RlciIsIk1JRF9TeW5jUG9zIiwiTUlEX01vbnN0ZXJJbmZvIiwib25lcnJvciIsIm9uY2xvc2UiLCJzZW5kd3NtZXNzYWdlIiwiQ0xPU0VEIiwiQ0xPU0lORyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7O0FBSUEsSUFBSUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFwQixFQUVBOzs7QUFDQSxJQUFJQyxVQUFVLEdBQUc7QUFDYkMsRUFBQUEsT0FBTyxFQUFFLEtBREk7QUFDRztBQUNoQkMsRUFBQUEsVUFBVSxFQUFFLElBRkM7QUFHYkMsRUFBQUEsZ0JBQWdCLEVBQUUsSUFITDtBQUliQyxFQUFBQSxlQUFlLEVBQUUsS0FKSjtBQUtiQyxFQUFBQSxtQkFBbUIsRUFBRSxJQUxSO0FBT2JDLEVBQUFBLEtBQUssRUFBRSxpQkFBVztBQUNkQyxJQUFBQSxZQUFZLENBQUMsS0FBS0wsVUFBTixDQUFaO0FBQ0FLLElBQUFBLFlBQVksQ0FBQyxLQUFLSixnQkFBTixDQUFaO0FBQ0EsV0FBTyxJQUFQO0FBQ0gsR0FYWTtBQWFiSyxFQUFBQSxjQUFjLEVBQUUsMEJBQVc7QUFDdkIsUUFBSUMsSUFBSSxHQUFHLElBQVg7QUFDQSxTQUFLUCxVQUFMLEdBQWtCUSxVQUFVLENBQUMsWUFBVztBQUNwQztBQUNBQyxNQUFBQSxFQUFFLENBQUNDLEdBQUgsQ0FBTyxvQkFBUDs7QUFDQSxVQUFJZCxNQUFNLENBQUNlLEVBQVAsSUFBYSxJQUFqQixFQUF1QjtBQUNuQjtBQUNIOztBQUVELFVBQUlDLElBQUksR0FBRyxJQUFJQyxXQUFKLENBQWdCLEVBQWhCLENBQVg7QUFDQSxVQUFJQyxJQUFJLEdBQUcsSUFBSUMsV0FBSixDQUFnQkgsSUFBaEIsQ0FBWDtBQUVBRSxNQUFBQSxJQUFJLENBQUMs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YSxFQUFFLHVCQUFTbEUsSUFBVCxFQUFjO0FBRXpCLFFBQUlsQixNQUFNLENBQUNlLEVBQVAsSUFBYSxJQUFqQixFQUF1QjtBQUNuQjtBQUNIOztBQUVELFFBQUlmLE1BQU0sQ0FBQ2UsRUFBUCxJQUFhLElBQWpCLEVBQXVCO0FBQ25CLFVBQUlmLE1BQU0sQ0FBQ2UsRUFBUCxDQUFVZ0QsVUFBVixJQUF3QkMsU0FBUyxDQUFDcUIsTUFBbEMsSUFBNENyRixNQUFNLENBQUNlLEVBQVAsQ0FBVWdELFVBQVYsSUFBd0JDLFNBQVMsQ0FBQ3NCLE9BQWxGLEVBQTJGO0FBQUU7QUFDekY7QUFDSDtBQUNKLEtBVndCLENBWXpCOzs7QUFDQXRGLElBQUFBLE1BQU0sQ0FBQ2UsRUFBUCxDQUFVTSxJQUFWLENBQWVILElBQWY7QUFDSDtBQWxJSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogd2Vic29ja2V0IFxyXG4gKi9cclxuXHJcbmxldCBHbG9iYWwgPSByZXF1aXJlKFwiY29tbW9uXCIpXHJcblxyXG4vL+W/g+i3s+ajgOa1i1xyXG52YXIgSGVhcnRDaGVjayA9IHtcclxuICAgIHRpbWVvdXQ6IDYwMDAwLCAvLzYw56eSXHJcbiAgICB0aW1lb3V0T2JqOiBudWxsLFxyXG4gICAgc2VydmVyVGltZW91dE9iajogbnVsbCxcclxuICAgIGRpc2Nvbm5lY3Rpb25lZDogZmFsc2UsXHJcbiAgICByZWNvbm5lY3RUaW1lb3V0b2JqOiBudWxsLFxyXG5cclxuICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0T2JqKTtcclxuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zZXJ2ZXJUaW1lb3V0T2JqKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH0sXHJcblxyXG4gICAgc3RhcnRIZWFydEJlYXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICB0aGlzLnRpbWVvdXRPYmogPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvL+i/memHjOWPkemAgeS4gOS4quW/g+i3s++8jOWQjuerr+aUtuWIsOWQju+8jOi/lOWbnuS4gOS4quW/g+i3s+a2iOaBr++8jG9ubWVzc2FnZeaLv+WIsOi/lOWbnueahOW/g+i3s+WwseivtOaYjui/nuaOpeato+W4uFxyXG4gICAgICAgICAgICBjYy5sb2coXCJzZW5kIGhlYXJ0IGJlYXQuLi5cIilcclxuICAgICAgICAgICAgaWYgKEdsb2JhbC53cyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgICAgfSBcclxuXHJcbiAgICAgICAgICAgIHZhciBidWZmID0gbmV3IEFycmF5QnVmZmVyKDEyKVxyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IG5ldyBVaW50MzJBcnJheShidWZmKVxyXG4gICAgXHJcbiAgICAgICAgICAgIGRhdGFbMF0gPSBHbG9iYWwuTUlEX0hlYXJ0QmVhdCAvL+a2iOaBr0lEXHJcbiAgICAgICAgICAgIGRhdGFbMV0gPSAxIC8v5raI5oGv6ZW/5bqmXHJcbiAgICAgICAgICAgIGRhdGFbMl0gPSAwIC8vYW55dGhpbmcg6ZqP5oSP5aGr5YWF5LiA5Liq5pWwXHJcblxyXG4gICAgICAgICAgICBHbG9iYWwud3Muc2VuZChkYXRhKTtcclxuICAgICAgICAgICAgc2VsZi5zZXJ2ZXJUaW1lb3V0T2JqID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsgLy/lv4Pot7PotoXml7bkuLvliqjmlq3lvIBcclxuICAgICAgICAgICAgICAgIGNjLmxvZyhcImNsb3NlIGNvbm5lY3Rpb24uLi5cIilcclxuICAgICAgICAgICAgICAgIGlmIChHbG9iYWwud3MgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgICAgIEdsb2JhbC53cy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5kaXNjb25uZWN0aW9uZWQgPSB0cnVlXHJcbiAgICAgICAgICAgIH0sIHNlbGYudGltZW91dClcclxuICAgICAgICB9LCB0aGlzLnRpbWVvdXQpXHJcbiAgICB9LFxyXG5cclxuICAgIGhhc0Rpc2Nvbm5lY3RlZDogZnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5kaXNjb25uZWN0aW9uZWRcclxuICAgIH0sXHJcblxyXG4gICAgc3RvcFJlY29ubmVjdFRpbWVyOiBmdW5jdGlvbigpe1xyXG4gICAgICAgIC8vY2MubG9nKFwiY2xvc2UgcmVjb25uZWN0VGltZW91dC4uLlwiKVxyXG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJlY29ubmVjdFRpbWVvdXRvYmopO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICog5raI5oGv5Zue5aSN5aSE55CGXHJcbiAqL1xyXG52YXIgTWVzc2FnZVN0YXRlRnVuYyA9IHtcclxuICAgIC8qKlxyXG4gICAgICog5raI5oGv6Kej5p6QIFxyXG4gICAgICogMDog5raI5oGvaWRcclxuICAgICAqIDHvvJrmtojmga/plb/luqZcclxuICAgICAqIDLvvJpzZXNzaW9uaWRcclxuICAgICAqIDPvvJpub2RleCB45Z2Q5qCH5q2j6LSf5qCH6K6wXHJcbiAgICAgKiA077yabm9kZXggeOWdkOagh+WAvFxyXG4gICAgICogNe+8mm5vZGV5IHnlnZDmoIfmraPotJ/moIforrBcclxuICAgICAqIDbvvJpub2RleSB55Z2Q5qCH5YC8IFxyXG4gICAgICovXHJcbiAgICBvbmxvZ2luOiBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGRhdGFbMl0gPT0gMSkge1xyXG4gICAgICAgICAgICBHbG9iYWwubXlTZXNzaW9uSWQgPSBkYXRhWzNdXHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2MubG9nKFwid3MgbWVzc2FnZSBNSURfbG9naW46IFwiLCBkYXRhWzJdLCBkYXRhWzNdLCBkYXRhWzRdLCBkYXRhWzVdLCBkYXRhWzZdLCBkYXRhWzddKVxyXG4gICAgICAgIEdsb2JhbC5Mb2dpblN1Y2MgPSBkYXRhWzJdXHJcbiAgICAgICAgdmFyIG5vZGV4ID0gZGF0YVs1XVxyXG4gICAgICAgIHZhciBub2RleSA9IGRhdGFbN11cclxuICAgICAgICBpZiAoZGF0YVs0XSA9PSAyKXtcclxuICAgICAgICAgICAgbm9kZXggPSAwIC0gbm9kZXhcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGRhdGFbNl0gPT0gMil7XHJcbiAgICAgICAgICAgIG5vZGV5ID0gMCAtIG5vZGV5XHJcbiAgICAgICAgfVxyXG4gICAgICAgIEdsb2JhbC5Nb3N0ZXJQb3NYID0gbm9kZXhcclxuICAgICAgICBHbG9iYWwuTW9zdGVyUG9zWSA9IG5vZGV5XHJcbiAgICB9LFxyXG5cclxuICAgIG9ubG9nb3V0OiBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgdmFyIGtleSA9IGRhdGFbMl0udG9TdHJpbmcoKVxyXG4gICAgICAgIGNjLmxvZyhcIndzIG1lc3NhZ2UgTUlEX2xvZ291dCwgc2Vzc2lvbmlkOiBcIiwga2V5KVxyXG4gICAgICAgIEdsb2JhbC5EZWxQbGF5ZXJJZHMucHVzaChrZXkpXHJcbiAgICAgICAgR2xvYmFsLlBsYXllclNlc3Npb25NYXAuZGVsZXRlKGtleSlcclxuICAgIH0sXHJcblxyXG4gICAgb25tb3ZlOiBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgY2MubG9nKFwid3MgbWVzc2FnZSBNSURfbW92ZTogXCIsIGRhdGFbMV0sIGRhdGFbMl0sIGRhdGFbM10sIGRhdGFbNF0sIGRhdGFbNV0sIGRhdGFbNl0pXHJcbiAgICAgICAgdmFyIGtleSA9IGRhdGFbNl0udG9TdHJpbmcoKVxyXG4gICAgICAgIHZhciBub2RleCA9IGRhdGFbM11cclxuICAgICAgICB2YXIgbm9kZXkgPSBkYXRhWzVdXHJcbiAgICAgICAgaWYgKGRhdGFbMl0gPT0gMil7XHJcbiAgICAgICAgICAgIG5vZGV4ID0gMCAtIG5vZGV4XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkYXRhWzRdID09IDIpe1xyXG4gICAgICAgICAgICBub2RleSA9IDAgLSBub2RleVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcGxheWVyUHJvcCA9IHtcclxuICAgICAgICAgICAgc2Vzc2lvbklkOiBkYXRhWzZdLFxyXG4gICAgICAgICAgICBub2RleDogbm9kZXgsXHJcbiAgICAgICAgICAgIG5vZGV5OiBub2RleVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoR2xvYmFsLlBsYXllclNlc3Npb25NYXAuaGFzKGtleSkgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgR2xvYmFsLlBsYXllclNlc3Npb25NYXAuc2V0KGtleSwgcGxheWVyUHJvcClcclxuICAgICAgICB9XHJcbiAgICAgICAgR2xvYmFsLk5ld3BsYXllck1hcC5zZXQoa2V5LCBwbGF5ZXJQcm9wKVxyXG4gICAgICAgIEdsb2JhbC5uZXdQbGF5ZXJJZHMucHVzaChrZXkpXHJcbiAgICAgICAgLy9jYy5sb2coXCJNSURfbW92ZSBwdXJwbGUgbW9uc3RlcnM6IFwiLCBHbG9iYWwubmV3UGxheWVySWRzLmxlbmd0aCwga2V5LCBHbG9iYWwuTmV3cGxheWVyTWFwLmhhcyhrZXkpKVxyXG4gICAgfSxcclxuXHJcbiAgICBvbkJ1bXA6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogIDA6IOa2iOaBr0lEXHJcbiAgICAgICAgICAgIDHvvJrmtojmga/plb/luqZcclxuICAgICAgICAgICAgMjog5oiQ5Yqf5aSx6LSl5qCH5b+XICjlpLHotKXliJnlj6rpnIDopoHliY3kuInkuKrlrZfmrrUpXHJcbiAgICAgICAgICAgIDM6IOaYn+aYn3jlnZDmoIfmraPotJ/moIflv5dcclxuICAgICAgICAgICAgNDog5pif5pifeOWdkOagh1xyXG4gICAgICAgICAgICA177ya5pif5pifeeWdkOagh+ato+i0n+agh+W/l1xyXG4gICAgICAgICAgICA277ya5pif5pifeeWdkOagh1xyXG4gICAgICAgICAgICAqL1xyXG5cclxuICAgICAgICBpZiAoZGF0YVsyXSA9PSAwKXsgLy/lpLHotKVcclxuICAgICAgICAgICAgY2MubG9nKFwid3MgbWVzc2FnZSBNSURfQnVtcCBmYWlsIC4uLiBcIilcclxuICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGNjLmxvZyhcIndzIG1lc3NhZ2UgTUlEX0J1bXA6IFwiLCBkYXRhWzFdLCBkYXRhWzJdLCBkYXRhWzNdLCBkYXRhWzRdLCBkYXRhWzVdLCBkYXRhWzZdLCBkYXRhWzddKVxyXG5cclxuICAgICAgICB2YXIgbm9kZXggPSBkYXRhWzRdXHJcbiAgICAgICAgdmFyIG5vZGV5ID0gZGF0YVs2XVxyXG4gICAgICAgIGlmIChkYXRhWzNdID09IDIpe1xyXG4gICAgICAgICAgICBub2RleCA9IDAgLSBub2RleFxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZGF0YVs1XSA9PSAyKXtcclxuICAgICAgICAgICAgbm9kZXkgPSAwIC0gbm9kZXlcclxuICAgICAgICB9XHJcbiAgICAgICAgR2xvYmFsLkJ1bXBlZFBsYXllcklkID0gZGF0YVs3XVxyXG4gICAgICAgIHZhciBzdGFyUHJvcCA9IHtcclxuICAgICAgICAgICAgbm9kZXg6IG5vZGV4LFxyXG4gICAgICAgICAgICBub2RleTogbm9kZXlcclxuICAgICAgICB9XHJcbiAgICAgICAgR2xvYmFsLm5ld1N0YXJQb3Muc2V0KEdsb2JhbC5uZXdTdGFyS2V5LCBzdGFyUHJvcClcclxuICAgIH0sXHJcblxyXG4gICAgb25IZWFydEJlYXQ6IGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgIGNjLmxvZyhcIndzIG1lc3NhZ2UgTUlEX0hlYXJ0QmVhdDogXCIsIG1zZ2lkKVxyXG4gICAgfSxcclxuXHJcbiAgICBvblN0YXJCb3JuOiBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgY2MubG9nKFwid3MgbWVzc2FnZSBNSURfU3RhckJvcm46IFwiLCBkYXRhWzJdLCBkYXRhWzNdLCBkYXRhWzRdLCBkYXRhWzVdKVxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqICAwOiDmtojmga9JRFxyXG4gICAgICAgICAgICAx77ya5raI5oGv6ZW/5bqmXHJcbiAgICAgICAgICAgIDI6IOaYn+aYn3jlnZDmoIfmraPotJ/moIflv5dcclxuICAgICAgICAgICAgMzog5pif5pifeOWdkOagh1xyXG4gICAgICAgICAgICA077ya5pif5pifeeWdkOagh+ato+i0n+agh+W/l1xyXG4gICAgICAgICAgICA177ya5pif5pifeeWdkOagh1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBub2RleCA9IGRhdGFbM11cclxuICAgICAgICB2YXIgbm9kZXkgPSBkYXRhWzVdXHJcbiAgICAgICAgaWYgKGRhdGFbMl0gPT0gMil7XHJcbiAgICAgICAgICAgIG5vZGV4ID0gMCAtIG5vZGV4XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkYXRhWzRdID09IDIpe1xyXG4gICAgICAgICAgICBub2RleSA9IDAgLSBub2RleVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgc3RhclByb3AgPSB7XHJcbiAgICAgICAgICAgIG5vZGV4OiBub2RleCxcclxuICAgICAgICAgICAgbm9kZXk6IG5vZGV5XHJcbiAgICAgICAgfVxyXG4gICAgICAgIEdsb2JhbC5uZXdTdGFyUG9zLnNldChHbG9iYWwubmV3U3RhcktleSwgc3RhclByb3ApXHJcbiAgICB9LFxyXG5cclxuICAgIG9uR006IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICBjYy5sb2coXCJ3cyBtZXNzYWdlIE1JRF9HTS4uLlwiKVxyXG4gICAgfSxcclxuXHJcbiAgICBPbmxpbmU0T3RoZXI6IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICBjYy5sb2coXCJ3cyBtZXNzYWdlIE1JRF9PbmxpbmU0T3RoZXI6IFwiLCBkYXRhWzFdLCBkYXRhWzJdLCBkYXRhWzNdLCBkYXRhWzRdLCBkYXRhWzVdLCBkYXRhWzZdKVxyXG4gICAgICAgIHZhciBrZXkgPSBkYXRhWzJdLnRvU3RyaW5nKClcclxuICAgICAgICB2YXIgbm9kZXggPSBkYXRhWzRdXHJcbiAgICAgICAgdmFyIG5vZGV5ID0gZGF0YVs2XVxyXG4gICAgICAgIGlmIChkYXRhWzNdID09IDIpe1xyXG4gICAgICAgICAgICBub2RleCA9IDAgLSBub2RleFxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZGF0YVs1XSA9PSAyKXtcclxuICAgICAgICAgICAgbm9kZXkgPSAwIC0gbm9kZXlcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHBsYXllclByb3AgPSB7XHJcbiAgICAgICAgICAgIHNlc3Npb25JZDogZGF0YVsyXSxcclxuICAgICAgICAgICAgbm9kZXg6IG5vZGV4LFxyXG4gICAgICAgICAgICBub2RleTogbm9kZXlcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKEdsb2JhbC5QbGF5ZXJTZXNzaW9uTWFwLmhhcyhrZXkpID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIEdsb2JhbC5QbGF5ZXJTZXNzaW9uTWFwLnNldChrZXksIHBsYXllclByb3ApXHJcbiAgICAgICAgfVxyXG4gICAgICAgIEdsb2JhbC5OZXdwbGF5ZXJNYXAuc2V0KGtleSwgcGxheWVyUHJvcClcclxuICAgICAgICBHbG9iYWwubmV3UGxheWVySWRzLnB1c2goa2V5KVxyXG4gICAgfSxcclxuXHJcbiAgICBvblJlZ2lzdGVyOiBmdW5jdGlvbihkYXRhKXtcclxuICAgICAgICBjYy5sb2coXCJ3cyBtZXNzYWdlIE1JRF9SZWdpc3RlcjogXCIsIGRhdGFbMl0pXHJcbiAgICAgICAgR2xvYmFsLlJlZ2lzdGVyU3VjYyA9IGRhdGFbMl1cclxuICAgIH0sXHJcblxyXG4gICAgb25TeW5jUG9zOiBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgY2MubG9nKFwid3MgbWVzc2FnZSBNSURfU3luY1BvczogXCIsIGRhdGFbMV0sIGRhdGFbMl0sIGRhdGFbM10sIGRhdGFbNF0sIGRhdGFbNV0sIGRhdGFbNl0pXHJcbiAgICAgICAgdmFyIGtleSA9IGRhdGFbNl0udG9TdHJpbmcoKVxyXG4gICAgICAgIHZhciBub2RleCA9IGRhdGFbM11cclxuICAgICAgICB2YXIgbm9kZXkgPSBkYXRhWzVdXHJcbiAgICAgICAgaWYgKGRhdGFbMl0gPT0gMil7XHJcbiAgICAgICAgICAgIG5vZGV4ID0gMCAtIG5vZGV4XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkYXRhWzRdID09IDIpe1xyXG4gICAgICAgICAgICBub2RleSA9IDAgLSBub2RleVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcGxheWVyUHJvcCA9IHtcclxuICAgICAgICAgICAgc2Vzc2lvbklkOiBkYXRhWzZdLFxyXG4gICAgICAgICAgICBub2RleDogbm9kZXgsXHJcbiAgICAgICAgICAgIG5vZGV5OiBub2RleVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoR2xvYmFsLlBsYXllclNlc3Npb25NYXAuaGFzKGtleSkgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgR2xvYmFsLlBsYXllclNlc3Npb25NYXAuc2V0KGtleSwgcGxheWVyUHJvcClcclxuICAgICAgICB9XHJcbiAgICAgICAgR2xvYmFsLk5ld3BsYXllck1hcC5zZXQoa2V5LCBwbGF5ZXJQcm9wKVxyXG4gICAgICAgIEdsb2JhbC5uZXdQbGF5ZXJJZHMucHVzaChrZXkpXHJcbiAgICB9LFxyXG5cclxuICAgIG9uTW9uc3RlckluZm86IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICBjYy5sb2coXCJ3cyBtZXNzYWdlIE1JRF9Nb25zdGVySW5mbzogXCIsIGRhdGFbMl0sIGRhdGFbM10pXHJcbiAgICAgICAgR2xvYmFsLk1vbnN0ZXJTY29yZSA9IGRhdGFbM11cclxuICAgIH1cclxufVxyXG5cclxuY2MuQ2xhc3Moe1xyXG4gICAgLy9leHRlbmRzOiBjYy5Db21wb25lbnQsXHJcblxyXG4gICAgLypcclxuICAgIHJlYWR5U3RhdGU6XHJcbiAgICAgICAgQ09OTkVDVElORyAwXHJcbiAgICAgICAgT1BFTiAgICAgICAxXHJcbiAgICAgICAgQ0xPU0lORyAgICAyXHJcbiAgICAgICAgQ0xPU0VEICAgICAzXHJcbiAgICAqL1xyXG4gICBcclxuICAgIENhblNlbmRNc2c6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgaWYgKEdsb2JhbC53cyA9PSBudWxsKXtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gKEdsb2JhbC53cy5yZWFkeVN0YXRlID09IFdlYlNvY2tldC5DT05ORUNUSU5HIHx8IEdsb2JhbC53cy5yZWFkeVN0YXRlID09IFdlYlNvY2tldC5PUEVOKVxyXG4gICAgfSwgXHJcblxyXG4gICAgc3dDb25uZWN0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgIGlmIChHbG9iYWwud3MgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAvL3JldHVyblxyXG4gICAgICAgICAgICAvL2NjLmxvZyhcInJlYWR5U3RhdGU6IFwiLCBHbG9iYWwud3MucmVhZHlTdGF0ZSlcclxuICAgICAgICAgICAgaWYgKEdsb2JhbC53cy5yZWFkeVN0YXRlID09IFdlYlNvY2tldC5DT05ORUNUSU5HIHx8IEdsb2JhbC53cy5yZWFkeVN0YXRlID09IFdlYlNvY2tldC5PUEVOKSB7IC8v5bey57uP6L+e5LiK5bCx5LiN5b+F5YaN6L+eXHJcbiAgICAgICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGNjLmxvZyhcImFkZHI6IFwiLCBHbG9iYWwud3NBZGRyLCBHbG9iYWwud3MgPT0gbnVsbClcclxuICAgICAgICB2YXIgd3MgPSBuZXcgV2ViU29ja2V0KEdsb2JhbC53c0FkZHIpO1xyXG4gICAgICAgIHdzLm9ub3BlbiA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgY2MubG9nKFwid3Mgb3BlbjogXCIsIHdzLnJlYWR5U3RhdGUpXHJcbiAgICAgICAgICAgIC8v5Y+R6YCB5b+D6LezXHJcbiAgICAgICAgICAgIEhlYXJ0Q2hlY2sucmVzZXQoKS5zdGFydEhlYXJ0QmVhdCgpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB3cy5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgIHZhciBkYXRhID0gbmV3IFVpbnQzMkFycmF5KGUuZGF0YSlcclxuICAgICAgICAgICAgdmFyIG1zZ2lkID0gZGF0YVswXSBcclxuICAgICAgICAgICAgc3dpdGNoIChtc2dpZCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBHbG9iYWwuTUlEX2xvZ2luOlxyXG4gICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTdGF0ZUZ1bmMub25sb2dpbihkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBHbG9iYWwuTUlEX2xvZ291dDpcclxuICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU3RhdGVGdW5jLm9ubG9nb3V0KGRhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEdsb2JhbC5NSURfbW92ZTpcclxuICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU3RhdGVGdW5jLm9ubW92ZShkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBHbG9iYWwuTUlEX0J1bXA6XHJcbiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVN0YXRlRnVuYy5vbkJ1bXAoZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICBicmVha1xyXG4gICAgICAgICAgICAgICAgY2FzZSBHbG9iYWwuTUlEX0hlYXJ0QmVhdDpcclxuICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU3RhdGVGdW5jLm9uSGVhcnRCZWF0KGRhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgICAgIGNhc2UgR2xvYmFsLk1JRF9TdGFyQm9ybjpcclxuICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU3RhdGVGdW5jLm9uU3RhckJvcm4oZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICBicmVha1xyXG4gICAgICAgICAgICAgICAgY2FzZSBHbG9iYWwuTUlEX0dNOlxyXG4gICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTdGF0ZUZ1bmMub25HTShkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgICAgICBjYXNlIEdsb2JhbC5NSURfT25saW5lNE90aGVyOlxyXG4gICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTdGF0ZUZ1bmMuT25saW5lNE90aGVyKGRhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgICAgIGNhc2UgR2xvYmFsLk1JRF9SZWdpc3RlcjpcclxuICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU3RhdGVGdW5jLm9uUmVnaXN0ZXIoZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICBicmVha1xyXG4gICAgICAgICAgICAgICAgY2FzZSBHbG9iYWwuTUlEX1N5bmNQb3M6XHJcbiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVN0YXRlRnVuYy5vblN5bmNQb3MoZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICBicmVha1xyXG4gICAgICAgICAgICAgICAgY2FzZSBHbG9iYWwuTUlEX01vbnN0ZXJJbmZvOlxyXG4gICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTdGF0ZUZ1bmMub25Nb25zdGVySW5mbyhkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIuacquefpSDmtojmga9pZDogXCIsIG1zZ2lkKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL+WPkemAgeW/g+i3s1xyXG4gICAgICAgICAgICBIZWFydENoZWNrLnJlc2V0KCkuc3RhcnRIZWFydEJlYXQoKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgd3Mub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGNjLmxvZyhcIndzIGVycm9yOiBcIiwgd3MucmVhZHlTdGF0ZSlcclxuICAgICAgICAgICAgLy9HbG9iYWwud3MgPSBudWxsXHJcbiAgICAgICAgICAgIGlmIChIZWFydENoZWNrLmhhc0Rpc2Nvbm5lY3RlZCgpID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBIZWFydENoZWNrLnN0b3BSZWNvbm5lY3RUaW1lcigpXHJcbiAgICAgICAgICAgICAgICBIZWFydENoZWNrLnJlY29ubmVjdFRpbWVvdXRvYmogPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc3dDb25uZWN0KCk7XHJcbiAgICAgICAgICAgICAgICB9LCAxMDAwKVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIEhlYXJ0Q2hlY2suc3RvcFJlY29ubmVjdFRpbWVyKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgd3Mub25jbG9zZSA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGNjLmxvZyhcIndzIGNsb3NlOiBcIiwgd3MucmVhZHlTdGF0ZSlcclxuICAgICAgICAgICAgLy9HbG9iYWwud3MgPSBudWxsXHJcbiAgICAgICAgICAgIGlmIChIZWFydENoZWNrLmhhc0Rpc2Nvbm5lY3RlZCgpID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBIZWFydENoZWNrLnN0b3BSZWNvbm5lY3RUaW1lcigpXHJcbiAgICAgICAgICAgICAgICBIZWFydENoZWNrLnJlY29ubmVjdFRpbWVvdXRvYmogPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc3dDb25uZWN0KCk7XHJcbiAgICAgICAgICAgICAgICB9LCAxMDAwKVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIEhlYXJ0Q2hlY2suc3RvcFJlY29ubmVjdFRpbWVyKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2MubG9nKFwiZ2xvYmFsIHdzIGluaXQsIHN0YXRlOiBcIiwgd3MucmVhZHlTdGF0ZSlcclxuICAgICAgICBHbG9iYWwud3MgPSB3c1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHsqfSBkYXRhICDlhbfkvZPmlbDmja4sIDHvvJrplb/luqbvvIwy77ya5piv5ZCm5bm/5pKt77yMM++8mi4uLiDlhbfkvZPmtojmga/mlbDmja5cclxuICAgICAqL1xyXG4gICAgc2VuZHdzbWVzc2FnZTogZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKEdsb2JhbC53cyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKEdsb2JhbC53cyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlmIChHbG9iYWwud3MucmVhZHlTdGF0ZSA9PSBXZWJTb2NrZXQuQ0xPU0VEIHx8IEdsb2JhbC53cy5yZWFkeVN0YXRlID09IFdlYlNvY2tldC5DTE9TSU5HKSB7IC8v5q2j5Zyo5pat5byA5oiW6ICF5bey57uP5pat5byA77yM5YiZ5LiN6IO95Y+R6YCB5raI5oGvXHJcbiAgICAgICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9jYy5sb2coXCJ3cyBzZW5kd3NtZXNzYWdlOiBcIiwgR2xvYmFsLndzLnJlYWR5U3RhdGUpXHJcbiAgICAgICAgR2xvYmFsLndzLnNlbmQoZGF0YSlcclxuICAgIH1cclxufSkiXX0=