
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Player.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6c688v72QdOKamCGCT+xaAd', 'Player');
// scripts/Player.js

"use strict";

var Global = require("common");

var wsNet = require("wsNet");

var GM = require("gm");

cc.Class({
  "extends": cc.Component,
  properties: {
    // 主角跳跃高度
    jumpHeight: 0,
    // 主角跳跃持续时间
    jumpDuration: 0,
    // 最大移动速度
    maxMoveSpeed: 0,
    // 加速度
    accel: 0,
    // 跳跃音效资源
    jumpAudio: {
      "default": null,
      type: cc.AudioClip
    },
    //
    accDirection: 0
  },
  getwsNetObj: function getwsNetObj() {
    return new wsNet();
  },
  getGMObj: function getGMObj() {
    return new GM();
  },
  setJumpAction: function setJumpAction() {
    // 跳跃上升
    var jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight)).easing(cc.easeCubicActionOut()); // 下落

    var jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight)).easing(cc.easeCubicActionIn()); // 添加一个回调函数，用于在动作结束时调用我们定义的其他方法

    var callback = cc.callFunc(this.playJumpSound, this); // 不断重复，而且每次完成落地动作后调用回调来播放声音

    return cc.repeatForever(cc.sequence(jumpUp, jumpDown, callback));
  },
  playJumpSound: function playJumpSound() {
    // 调用声音引擎播放声音
    cc.audioEngine.playEffect(this.jumpAudio, false);
  },
  onKeyDown: function onKeyDown(event) {
    // set a flag when key pressed
    switch (event.keyCode) {
      case cc.macro.KEY.a:
        this.accLeft = true;
        break;

      case cc.macro.KEY.d:
        this.accRight = true;
        break;
    }
  },
  onKeyUp: function onKeyUp(event) {
    // unset a flag when key released
    switch (event.keyCode) {
      case cc.macro.KEY.a:
        this.accLeft = false;
        break;

      case cc.macro.KEY.d:
        this.accRight = false;
        break;
    }
  },
  onLoad: function onLoad() {
    cc.game.setFrameRate(50);
    this.getwsNetObj().swConnect();
    Global.FirstLogin = null;
    Global.newStarPos = new Map(); // 初始化跳跃动作
    //this.jumpAction = this.setJumpAction();
    //this.node.runAction(this.jumpAction);
    // 加速度方向开关

    this.accLeft = false;
    this.accRight = false; // 主角当前水平方向速度

    this.xSpeed = (Math.random() - 0.5) * 2 * 10;
    this.TickFrame = 0; // 初始化键盘输入监听

    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this); //初始化小球位置

    this.randPlayerPos();
  },
  onDestroy: function onDestroy() {
    // 取消键盘输入监听
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);
  },
  //初始化随机小球所在位置，然后广播给其他人
  randPlayerPos: function randPlayerPos() {
    this.node.x = this.xSpeed * (this.node.width / 2);
    this.xSpeed = 0; //this.sendPlayerPos(Global.MID_login)
    //cc.log("randPlayerPos player pos: ", this.node.x, this.node.y)
  },
  stop: function stop() {
    this.xSpeed = 0;
  },
  sendPlayerPos: function sendPlayerPos(msgid) {
    //cc.log("send player pos: ", msgid, this.TickFrame, this.node.x, this.node.y)
    var buff = new ArrayBuffer(24);
    var data = new Uint32Array(buff);
    data[0] = msgid; //消息ID

    data[1] = 4; //消息长度

    var nodexflag = 1;
    var nodex = this.node.x;

    if (nodex < 0.0) {
      nodexflag = 2;
      nodex = 0.0 - nodex;
    }

    data[2] = nodexflag; //x坐标正负

    data[3] = parseInt(nodex); //x坐标

    var nodeyflag = 1;
    var nodey = -88; //this.node.y

    if (nodey < 0.0) {
      nodeyflag = 2;
      nodey = 0.0 - nodey;
    }

    data[4] = nodeyflag; //y坐标正负

    data[5] = parseInt(nodey); //y坐标

    this.getwsNetObj().sendwsmessage(data);
  },
  update: function update(dt) {
    //cc.log("player dt: ", this.accLeft, this.accRight)
    //第一次连线广播所在位置，然后获取其他小球所在位置然后进行展示
    if (Global.FirstLogin == null && this.getwsNetObj().CanSendMsg()) {
      this.sendPlayerPos(Global.MID_login); //this.getGMObj().sendResetStarPos() //gm矫正
      //this.scheduleOnce(function(){ this.sendPlayerPos(Global.MID_login); },2);

      Global.FirstLogin = 1;
    } //方向移动操作后没任何方向操作时，则慢慢减速直至停止


    if (this.accLeft == false && this.accRight == false) {
      this.xSpeed -= 0.1;

      if (this.xSpeed < 0) {
        this.xSpeed = 0;
      }
    } // 根据当前加速度方向每帧更新速度


    if (this.accLeft) {
      this.xSpeed -= this.accel * dt;
    } else if (this.accRight) {
      this.xSpeed += this.accel * dt;
    } // 限制主角的速度不能超过最大值


    if (Math.abs(this.xSpeed) > this.maxMoveSpeed) {
      // if speed reach limit, use max speed with current direction
      this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);
    } // 根据当前速度更新主角的位置

    /**
     * 超过边界则自动滚回场景内
     */


    if (this.node.x <= -595.0) {
      //this.xSpeed += this.accel * dt;
      this.xSpeed = 0;
      this.node.x = -595.0 + 20;
    } else if (this.node.x >= 595.0) {
      //this.xSpeed -= this.accel * dt;
      this.node.x = 595.0 - 20;
      this.xSpeed = 0;
    } else {
      this.node.x += this.xSpeed * dt;
    }

    if (Global.Bumped == 1) {
      this.xSpeed = 0;
      Global.Bumped = null; //移动广播所在位置，然后获取其他小球所在位置然后进行展示

      this.sendPlayerPos(Global.MID_move);
    }

    this.TickFrame += dt;

    if (this.TickFrame > 5.0) {
      //更新帧数据
      this.sendPlayerPos(Global.MID_move);
      this.TickFrame = 0;
    } //cc.log("player pos: ", this.node.x, this.node.y)

  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcUGxheWVyLmpzIl0sIm5hbWVzIjpbIkdsb2JhbCIsInJlcXVpcmUiLCJ3c05ldCIsIkdNIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJqdW1wSGVpZ2h0IiwianVtcER1cmF0aW9uIiwibWF4TW92ZVNwZWVkIiwiYWNjZWwiLCJqdW1wQXVkaW8iLCJ0eXBlIiwiQXVkaW9DbGlwIiwiYWNjRGlyZWN0aW9uIiwiZ2V0d3NOZXRPYmoiLCJnZXRHTU9iaiIsInNldEp1bXBBY3Rpb24iLCJqdW1wVXAiLCJtb3ZlQnkiLCJ2MiIsImVhc2luZyIsImVhc2VDdWJpY0FjdGlvbk91dCIsImp1bXBEb3duIiwiZWFzZUN1YmljQWN0aW9uSW4iLCJjYWxsYmFjayIsImNhbGxGdW5jIiwicGxheUp1bXBTb3VuZCIsInJlcGVhdEZvcmV2ZXIiLCJzZXF1ZW5jZSIsImF1ZGlvRW5naW5lIiwicGxheUVmZmVjdCIsIm9uS2V5RG93biIsImV2ZW50Iiwia2V5Q29kZSIsIm1hY3JvIiwiS0VZIiwiYSIsImFjY0xlZnQiLCJkIiwiYWNjUmlnaHQiLCJvbktleVVwIiwib25Mb2FkIiwiZ2FtZSIsInNldEZyYW1lUmF0ZSIsInN3Q29ubmVjdCIsIkZpcnN0TG9naW4iLCJuZXdTdGFyUG9zIiwiTWFwIiwieFNwZWVkIiwiTWF0aCIsInJhbmRvbSIsIlRpY2tGcmFtZSIsInN5c3RlbUV2ZW50Iiwib24iLCJTeXN0ZW1FdmVudCIsIkV2ZW50VHlwZSIsIktFWV9ET1dOIiwiS0VZX1VQIiwicmFuZFBsYXllclBvcyIsIm9uRGVzdHJveSIsIm9mZiIsIm5vZGUiLCJ4Iiwid2lkdGgiLCJzdG9wIiwic2VuZFBsYXllclBvcyIsIm1zZ2lkIiwiYnVmZiIsIkFycmF5QnVmZmVyIiwiZGF0YSIsIlVpbnQzMkFycmF5Iiwibm9kZXhmbGFnIiwibm9kZXgiLCJwYXJzZUludCIsIm5vZGV5ZmxhZyIsIm5vZGV5Iiwic2VuZHdzbWVzc2FnZSIsInVwZGF0ZSIsImR0IiwiQ2FuU2VuZE1zZyIsIk1JRF9sb2dpbiIsImFicyIsIkJ1bXBlZCIsIk1JRF9tb3ZlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLE1BQU0sR0FBR0MsT0FBTyxDQUFDLFFBQUQsQ0FBcEI7O0FBQ0EsSUFBSUMsS0FBSyxHQUFHRCxPQUFPLENBQUMsT0FBRCxDQUFuQjs7QUFDQSxJQUFJRSxFQUFFLEdBQUdGLE9BQU8sQ0FBQyxJQUFELENBQWhCOztBQUVBRyxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUsQ0FBQ0UsU0FEUDtBQUdMQyxFQUFBQSxVQUFVLEVBQUU7QUFDUjtBQUNBQyxJQUFBQSxVQUFVLEVBQUUsQ0FGSjtBQUdSO0FBQ0FDLElBQUFBLFlBQVksRUFBRSxDQUpOO0FBS1I7QUFDQUMsSUFBQUEsWUFBWSxFQUFFLENBTk47QUFPUjtBQUNBQyxJQUFBQSxLQUFLLEVBQUUsQ0FSQztBQVNSO0FBQ0FDLElBQUFBLFNBQVMsRUFBRTtBQUNQLGlCQUFTLElBREY7QUFFUEMsTUFBQUEsSUFBSSxFQUFFVCxFQUFFLENBQUNVO0FBRkYsS0FWSDtBQWNSO0FBQ0FDLElBQUFBLFlBQVksRUFBRTtBQWZOLEdBSFA7QUFxQkxDLEVBQUFBLFdBQVcsRUFBRSx1QkFBVztBQUNwQixXQUFPLElBQUlkLEtBQUosRUFBUDtBQUNILEdBdkJJO0FBeUJMZSxFQUFBQSxRQUFRLEVBQUUsb0JBQVc7QUFDakIsV0FBTyxJQUFJZCxFQUFKLEVBQVA7QUFDSCxHQTNCSTtBQTZCTGUsRUFBQUEsYUFBYSxFQUFFLHlCQUFZO0FBQ3ZCO0FBQ0EsUUFBSUMsTUFBTSxHQUFHZixFQUFFLENBQUNnQixNQUFILENBQVUsS0FBS1gsWUFBZixFQUE2QkwsRUFBRSxDQUFDaUIsRUFBSCxDQUFNLENBQU4sRUFBUyxLQUFLYixVQUFkLENBQTdCLEVBQXdEYyxNQUF4RCxDQUErRGxCLEVBQUUsQ0FBQ21CLGtCQUFILEVBQS9ELENBQWIsQ0FGdUIsQ0FHdkI7O0FB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QUNxRixRQUExQjtBQUNIOztBQUVELFNBQUtoQyxTQUFMLElBQWtCMkIsRUFBbEI7O0FBQ0EsUUFBSSxLQUFLM0IsU0FBTCxHQUFpQixHQUFyQixFQUEwQjtBQUN0QjtBQUNBLFdBQUtjLGFBQUwsQ0FBbUJuRSxNQUFNLENBQUNxRixRQUExQjtBQUNBLFdBQUtoQyxTQUFMLEdBQWlCLENBQWpCO0FBQ0gsS0ExRGlCLENBMkRsQjs7QUFDSDtBQTFNSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgR2xvYmFsID0gcmVxdWlyZShcImNvbW1vblwiKVxubGV0IHdzTmV0ID0gcmVxdWlyZShcIndzTmV0XCIpXG5sZXQgR00gPSByZXF1aXJlKFwiZ21cIilcblxuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcbiAgICBcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIC8vIOS4u+inkui3s+i3g+mrmOW6plxuICAgICAgICBqdW1wSGVpZ2h0OiAwLFxuICAgICAgICAvLyDkuLvop5Lot7Pot4PmjIHnu63ml7bpl7RcbiAgICAgICAganVtcER1cmF0aW9uOiAwLFxuICAgICAgICAvLyDmnIDlpKfnp7vliqjpgJ/luqZcbiAgICAgICAgbWF4TW92ZVNwZWVkOiAwLFxuICAgICAgICAvLyDliqDpgJ/luqZcbiAgICAgICAgYWNjZWw6IDAsXG4gICAgICAgIC8vIOi3s+i3g+mfs+aViOi1hOa6kFxuICAgICAgICBqdW1wQXVkaW86IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5BdWRpb0NsaXBcbiAgICAgICAgfSxcbiAgICAgICAgLy9cbiAgICAgICAgYWNjRGlyZWN0aW9uOiAwLFxuICAgIH0sXG5cbiAgICBnZXR3c05ldE9iajogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBuZXcgd3NOZXQoKTtcbiAgICB9LFxuXG4gICAgZ2V0R01PYmo6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gbmV3IEdNKCk7XG4gICAgfSxcblxuICAgIHNldEp1bXBBY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8g6Lez6LeD5LiK5Y2HXG4gICAgICAgIHZhciBqdW1wVXAgPSBjYy5tb3ZlQnkodGhpcy5qdW1wRHVyYXRpb24sIGNjLnYyKDAsIHRoaXMuanVtcEhlaWdodCkpLmVhc2luZyhjYy5lYXNlQ3ViaWNBY3Rpb25PdXQoKSk7XG4gICAgICAgIC8vIOS4i+iQvVxuICAgICAgICB2YXIganVtcERvd24gPSBjYy5tb3ZlQnkodGhpcy5qdW1wRHVyYXRpb24sIGNjLnYyKDAsIC10aGlzLmp1bXBIZWlnaHQpKS5lYXNpbmcoY2MuZWFzZUN1YmljQWN0aW9uSW4oKSk7XG4gICAgICAgIC8vIOa3u+WKoOS4gOS4quWbnuiwg+WHveaVsO+8jOeUqOS6juWcqOWKqOS9nOe7k+adn+aXtuiwg+eUqOaIkeS7rOWumuS5ieeahOWFtuS7luaWueazlVxuICAgICAgICB2YXIgY2FsbGJhY2sgPSBjYy5jYWxsRnVuYyh0aGlzLnBsYXlKdW1wU291bmQsIHRoaXMpO1xuICAgICAgICAvLyDkuI3mlq3ph43lpI3vvIzogIzkuJTmr4/mrKHlrozmiJDokL3lnLDliqjkvZzlkI7osIPnlKjlm57osIPmnaXmkq3mlL7lo7Dpn7NcbiAgICAgICAgcmV0dXJuIGNjLnJlcGVhdEZvcmV2ZXIoY2Muc2VxdWVuY2UoanVtcFVwLCBqdW1wRG93biwgY2FsbGJhY2spKTtcbiAgICB9LFxuXG4gICAgcGxheUp1bXBTb3VuZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyDosIPnlKjlo7Dpn7PlvJXmk47mkq3mlL7lo7Dpn7NcbiAgICAgICAgY2MuYXVkaW9FbmdpbmUucGxheUVmZmVjdCh0aGlzLmp1bXBBdWRpbywgZmFsc2UpO1xuICAgIH0sXG5cbiAgICBvbktleURvd24gKGV2ZW50KSB7XG4gICAgICAgIC8vIHNldCBhIGZsYWcgd2hlbiBrZXkgcHJlc3NlZFxuICAgICAgICBzd2l0Y2goZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkuYTpcbiAgICAgICAgICAgICAgICB0aGlzLmFjY0xlZnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkuZDpcbiAgICAgICAgICAgICAgICB0aGlzLmFjY1JpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbktleVVwIChldmVudCkge1xuICAgICAgICAvLyB1bnNldCBhIGZsYWcgd2hlbiBrZXkgcmVsZWFzZWRcbiAgICAgICAgc3dpdGNoKGV2ZW50LmtleUNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLmE6XG4gICAgICAgICAgICAgICAgdGhpcy5hY2NMZWZ0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5kOlxuICAgICAgICAgICAgICAgIHRoaXMuYWNjUmlnaHQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbkxvYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBjYy5nYW1lLnNldEZyYW1lUmF0ZSg1MCk7XG4gICAgICAgIHRoaXMuZ2V0d3NOZXRPYmooKS5zd0Nvbm5lY3QoKVxuICAgICAgICBHbG9iYWwuRmlyc3RMb2dpbiA9IG51bGxcbiAgICAgICAgR2xvYmFsLm5ld1N0YXJQb3MgPSBuZXcgTWFwKCk7XG4gICAgICAgIFxuICAgICAgICAvLyDliJ3lp4vljJbot7Pot4PliqjkvZxcbiAgICAgICAgLy90aGlzLmp1bXBBY3Rpb24gPSB0aGlzLnNldEp1bXBBY3Rpb24oKTtcbiAgICAgICAgLy90aGlzLm5vZGUucnVuQWN0aW9uKHRoaXMuanVtcEFjdGlvbik7XG4gICAgICAgIC8vIOWKoOmAn+W6puaWueWQkeW8gOWFs1xuICAgICAgICB0aGlzLmFjY0xlZnQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hY2NSaWdodCA9IGZhbHNlO1xuXG4gICAgICAgIC8vIOS4u+inkuW9k+WJjeawtOW5s+aWueWQkemAn+W6plxuICAgICAgICB0aGlzLnhTcGVlZCA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIgKiAxMDtcbiAgICAgICAgdGhpcy5UaWNrRnJhbWUgPSAwO1xuICAgICAgICAvLyDliJ3lp4vljJbplK7nm5jovpPlhaXnm5HlkKxcbiAgICAgICAgY2Muc3lzdGVtRXZlbnQub24oY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9ET1dOLCB0aGlzLm9uS2V5RG93biwgdGhpcyk7XG4gICAgICAgIGNjLnN5c3RlbUV2ZW50Lm9uKGNjLlN5c3RlbUV2ZW50LkV2ZW50VHlwZS5LRVlfVVAsIHRoaXMub25LZXlVcCwgdGhpcyk7ICBcbiAgICAgICAgXG4gICAgICAgIC8v5Yid5aeL5YyW5bCP55CD5L2N572uXG4gICAgICAgIHRoaXMucmFuZFBsYXllclBvcygpXG4gICAgfSxcblxuICAgIG9uRGVzdHJveSAoKSB7XG4gICAgICAgIC8vIOWPlua2iOmUruebmOi+k+WFpeebkeWQrFxuICAgICAgICBjYy5zeXN0ZW1FdmVudC5vZmYoY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9ET1dOLCB0aGlzLm9uS2V5RG93biwgdGhpcyk7XG4gICAgICAgIGNjLnN5c3RlbUV2ZW50Lm9mZihjYy5TeXN0ZW1FdmVudC5FdmVudFR5cGUuS0VZX1VQLCB0aGlzLm9uS2V5VXAsIHRoaXMpO1xuICAgIH0sICAgIFxuXG4gICAgLy/liJ3lp4vljJbpmo/mnLrlsI/nkIPmiYDlnKjkvY3nva7vvIznhLblkI7lub/mkq3nu5nlhbbku5bkurpcbiAgICByYW5kUGxheWVyUG9zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5ub2RlLnggPSB0aGlzLnhTcGVlZCAqICh0aGlzLm5vZGUud2lkdGgvMilcbiAgICAgICAgdGhpcy54U3BlZWQgPSAwXG4gICAgICAgIC8vdGhpcy5zZW5kUGxheWVyUG9zKEdsb2JhbC5NSURfbG9naW4pXG4gICAgICAgIC8vY2MubG9nKFwicmFuZFBsYXllclBvcyBwbGF5ZXIgcG9zOiBcIiwgdGhpcy5ub2RlLngsIHRoaXMubm9kZS55KVxuICAgIH0sXG5cbiAgICBzdG9wOiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLnhTcGVlZCA9IDBcbiAgICB9LFxuXG4gICAgc2VuZFBsYXllclBvczogZnVuY3Rpb24obXNnaWQpIHtcbiAgICAgICAgLy9jYy5sb2coXCJzZW5kIHBsYXllciBwb3M6IFwiLCBtc2dpZCwgdGhpcy5UaWNrRnJhbWUsIHRoaXMubm9kZS54LCB0aGlzLm5vZGUueSlcblxuICAgICAgICB2YXIgYnVmZiA9IG5ldyBBcnJheUJ1ZmZlcigyNClcbiAgICAgICAgdmFyIGRhdGEgPSBuZXcgVWludDMyQXJyYXkoYnVmZilcblxuICAgICAgICBkYXRhWzBdID0gbXNnaWQgLy/mtojmga9JRFxuICAgICAgICBkYXRhWzFdID0gNCAvL+a2iOaBr+mVv+W6plxuXG4gICAgICAgIHZhciBub2RleGZsYWcgPSAxXG4gICAgICAgIHZhciBub2RleCA9IHRoaXMubm9kZS54XG4gICAgICAgIGlmIChub2RleCA8IDAuMCkge1xuICAgICAgICAgICAgbm9kZXhmbGFnID0gMlxuICAgICAgICAgICAgbm9kZXggPSAwLjAgLSBub2RleFxuICAgICAgICB9XG5cbiAgICAgICAgZGF0YVsyXSA9IG5vZGV4ZmxhZyAgICAgLy945Z2Q5qCH5q2j6LSfXG4gICAgICAgIGRhdGFbM10gPSBwYXJzZUludChub2RleCkgLy945Z2Q5qCHXG4gICAgICAgIHZhciBub2RleWZsYWcgPSAxXG4gICAgICAgIHZhciBub2RleSA9IC04OCAvL3RoaXMubm9kZS55XG4gICAgICAgIGlmIChub2RleSA8IDAuMCkge1xuICAgICAgICAgICAgbm9kZXlmbGFnID0gMlxuICAgICAgICAgICAgbm9kZXkgPSAwLjAgLSBub2RleVxuICAgICAgICB9XG5cbiAgICAgICAgZGF0YVs0XSA9IG5vZGV5ZmxhZyAgICAvL3nlnZDmoIfmraPotJ9cbiAgICAgICAgZGF0YVs1XSA9IHBhcnNlSW50KG5vZGV5KSAvL3nlnZDmoIdcblxuICAgICAgICB0aGlzLmdldHdzTmV0T2JqKCkuc2VuZHdzbWVzc2FnZShkYXRhKVxuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uIChkdCkge1xuICAgICAgICAvL2NjLmxvZyhcInBsYXllciBkdDogXCIsIHRoaXMuYWNjTGVmdCwgdGhpcy5hY2NSaWdodClcbiAgICAgICAgLy/nrKzkuIDmrKHov57nur/lub/mkq3miYDlnKjkvY3nva7vvIznhLblkI7ojrflj5blhbbku5blsI/nkIPmiYDlnKjkvY3nva7nhLblkI7ov5vooYzlsZXnpLpcbiAgICAgICAgaWYgKEdsb2JhbC5GaXJzdExvZ2luID09IG51bGwgJiYgdGhpcy5nZXR3c05ldE9iaigpLkNhblNlbmRNc2coKSl7XG4gICAgICAgICAgICB0aGlzLnNlbmRQbGF5ZXJQb3MoR2xvYmFsLk1JRF9sb2dpbilcbiAgICAgICAgICAgIC8vdGhpcy5nZXRHTU9iaigpLnNlbmRSZXNldFN0YXJQb3MoKSAvL2dt55+r5q2jXG4gICAgICAgICAgICAvL3RoaXMuc2NoZWR1bGVPbmNlKGZ1bmN0aW9uKCl7IHRoaXMuc2VuZFBsYXllclBvcyhHbG9iYWwuTUlEX2xvZ2luKTsgfSwyKTtcbiAgICAgICAgICAgIEdsb2JhbC5GaXJzdExvZ2luID0gMVxuICAgICAgICB9XG5cbiAgICAgICAgLy/mlrnlkJHnp7vliqjmk43kvZzlkI7msqHku7vkvZXmlrnlkJHmk43kvZzml7bvvIzliJnmhaLmhaLlh4/pgJ/nm7Toh7PlgZzmraJcbiAgICAgICAgaWYgKHRoaXMuYWNjTGVmdCA9PSBmYWxzZSAmJiB0aGlzLmFjY1JpZ2h0ID09IGZhbHNlKSB7XG4gICAgICAgICAgICB0aGlzLnhTcGVlZCAtPSAwLjFcbiAgICAgICAgICAgIGlmICh0aGlzLnhTcGVlZCA8IDAgKSB7XG4gICAgICAgICAgICAgICAgdGhpcy54U3BlZWQgPSAwXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyDmoLnmja7lvZPliY3liqDpgJ/luqbmlrnlkJHmr4/luKfmm7TmlrDpgJ/luqZcbiAgICAgICAgaWYgKHRoaXMuYWNjTGVmdCkge1xuICAgICAgICAgICAgdGhpcy54U3BlZWQgLT0gdGhpcy5hY2NlbCAqIGR0O1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYWNjUmlnaHQpIHtcbiAgICAgICAgICAgIHRoaXMueFNwZWVkICs9IHRoaXMuYWNjZWwgKiBkdDtcbiAgICAgICAgfVxuICAgICAgICAvLyDpmZDliLbkuLvop5LnmoTpgJ/luqbkuI3og73otoXov4fmnIDlpKflgLxcbiAgICAgICAgaWYgKCBNYXRoLmFicyh0aGlzLnhTcGVlZCkgPiB0aGlzLm1heE1vdmVTcGVlZCApIHtcbiAgICAgICAgICAgIC8vIGlmIHNwZWVkIHJlYWNoIGxpbWl0LCB1c2UgbWF4IHNwZWVkIHdpdGggY3VycmVudCBkaXJlY3Rpb25cbiAgICAgICAgICAgIHRoaXMueFNwZWVkID0gdGhpcy5tYXhNb3ZlU3BlZWQgKiB0aGlzLnhTcGVlZCAvIE1hdGguYWJzKHRoaXMueFNwZWVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOagueaNruW9k+WJjemAn+W6puabtOaWsOS4u+inkueahOS9jee9rlxuICAgICAgICAvKipcbiAgICAgICAgICog6LaF6L+H6L6555WM5YiZ6Ieq5Yqo5rua5Zue5Zy65pmv5YaFXG4gICAgICAgICAqL1xuICAgICAgICBpZiAodGhpcy5ub2RlLnggPD0gLTU5NS4wKSB7XG4gICAgICAgICAgICAvL3RoaXMueFNwZWVkICs9IHRoaXMuYWNjZWwgKiBkdDtcbiAgICAgICAgICAgIHRoaXMueFNwZWVkID0gMFxuICAgICAgICAgICAgdGhpcy5ub2RlLnggPSAtNTk1LjAgKyAyMFxuICAgICAgICB9ZWxzZSBpZiAodGhpcy5ub2RlLnggPj0gNTk1LjApIHtcbiAgICAgICAgICAgIC8vdGhpcy54U3BlZWQgLT0gdGhpcy5hY2NlbCAqIGR0O1xuICAgICAgICAgICAgdGhpcy5ub2RlLnggPSA1OTUuMCAtIDIwXG4gICAgICAgICAgICB0aGlzLnhTcGVlZCA9IDBcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB0aGlzLm5vZGUueCArPSB0aGlzLnhTcGVlZCAqIGR0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKEdsb2JhbC5CdW1wZWQgPT0gMSl7XG4gICAgICAgICAgICB0aGlzLnhTcGVlZCA9IDBcbiAgICAgICAgICAgIEdsb2JhbC5CdW1wZWQgPSBudWxsXG4gICAgICAgICAgICAvL+enu+WKqOW5v+aSreaJgOWcqOS9jee9ru+8jOeEtuWQjuiOt+WPluWFtuS7luWwj+eQg+aJgOWcqOS9jee9rueEtuWQjui/m+ihjOWxleekulxuICAgICAgICAgICAgdGhpcy5zZW5kUGxheWVyUG9zKEdsb2JhbC5NSURfbW92ZSlcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuVGlja0ZyYW1lICs9IGR0XG4gICAgICAgIGlmICh0aGlzLlRpY2tGcmFtZSA+IDUuMCApe1xuICAgICAgICAgICAgLy/mm7TmlrDluKfmlbDmja5cbiAgICAgICAgICAgIHRoaXMuc2VuZFBsYXllclBvcyhHbG9iYWwuTUlEX21vdmUpXG4gICAgICAgICAgICB0aGlzLlRpY2tGcmFtZSA9IDBcbiAgICAgICAgfVxuICAgICAgICAvL2NjLmxvZyhcInBsYXllciBwb3M6IFwiLCB0aGlzLm5vZGUueCwgdGhpcy5ub2RlLnkpXG4gICAgfSxcbn0pO1xuXG5cbiJdfQ==